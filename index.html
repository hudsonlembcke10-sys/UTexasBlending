<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refinery Analytics Dashboard - Complete Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            min-height: 100vh;
            color: #333;
        }
        
        /* Navigation */
        .nav-header {
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.3);
        }
        
        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8em;
            font-weight: 300;
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
        }
        
        .nav-buttons {
            display: flex;
            gap: 15px;
        }
        
        .nav-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        /* Main Dashboard Container */
        .dashboard-container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        /* Market Status Bar */
        .market-status {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .market-status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .status-title {
            font-size: 1.5em;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .live-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .live-dot {
            width: 10px;
            height: 10px;
            background: #27ae60;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .market-prices {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
        }
        
        .price-card {
            padding: 12px;
            border-radius: 8px;
            color: white;
            text-align: center;
            transition: transform 0.2s;
        }
        
        .price-card:hover {
            transform: translateY(-2px);
        }
        
        .price-label {
            font-size: 0.85em;
            opacity: 0.95;
            margin-bottom: 4px;
        }
        
        .price-value {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .price-change {
            font-size: 0.75em;
            opacity: 0.9;
        }
        
        .price-up { color: #2ecc71; }
        .price-down { color: #e74c3c; }
        
        .product-category-header {
            color: #2c3e50;
            font-size: 1.1em;
            font-weight: 600;
            margin: 20px 0 12px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        /* Hot Crudes Section */
        .hot-crudes-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .hot-crudes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .hot-crudes-title {
            font-size: 1.8em;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .fire-icon { color: #e74c3c; }
        
        /* Refinery Configuration Tabs */
        .refinery-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
        }
        
        .refinery-tab {
            padding: 10px 20px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s;
            flex: 1;
            text-align: center;
        }
        
        .refinery-tab:hover {
            background: #f0f0f0;
            transform: translateY(-1px);
        }
        
        .refinery-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            font-weight: 600;
        }
        
        .refinery-description {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        
        .refinery-description h4 {
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .refinery-description p {
            color: #5a6c7d;
            font-size: 0.9em;
            line-height: 1.5;
        }
        
        .crude-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .crude-table th {
            background: #34495e;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 500;
            font-size: 0.9em;
        }
        
        .crude-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #ecf0f1;
            font-size: 0.9em;
        }
        
        .crude-table tr:hover {
            background: #f8f9fa;
        }
        
        .rank-badge {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.85em;
        }
        
        .gold-badge {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
        }
        
        .silver-badge {
            background: linear-gradient(135deg, #c0c0c0 0%, #808080 100%);
        }
        
        .bronze-badge {
            background: linear-gradient(135deg, #cd7f32 0%, #8b4513 100%);
        }
        
        /* Upgrade Economics Section */
        .upgrade-section {
            background: linear-gradient(to right, #fff 0%, #f0f8ff 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }
        
        .upgrade-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        
        .upgrade-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        
        .upgrade-table thead th {
            padding: 10px;
            text-align: left;
            color: white;
            font-weight: 500;
        }
        
        .upgrade-table tbody td {
            padding: 8px 10px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .chart-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
        }
        
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
    </style>
</head>
<body>
    <!-- Navigation Header -->
    <div class="nav-header">
        <div class="nav-content">
            <div class="logo">
                <div class="logo-icon">üè≠</div>
                <span>Refinery Analytics Pro</span>
            </div>
            <div class="nav-buttons">
                <button class="nav-btn" onclick="showDashboard()">Dashboard</button>
                <button class="nav-btn" onclick="showLPModel()">LP Model</button>
                <button class="nav-btn" onclick="showBlendingCalc()">Blending Calculator</button>
                <button class="nav-btn" onclick="showCustomCrude()">Add Crude</button>
                <button class="nav-btn" onclick="showAssumptions()">Settings</button>
            </div>
        </div>
    </div>
    
    <!-- Dashboard Page -->
    <div id="dashboardPage" class="dashboard-container">
        <!-- Live Market Conditions with All Products -->
        <div class="market-status">
            <div class="market-status-header">
                <h2 class="status-title">Live Market Conditions - Global Refined Products</h2>
                <div class="live-indicator">
                    <div class="live-dot"></div>
                    <span>Live Data ‚Ä¢ Singapore/Rotterdam/USGC</span>
                </div>
            </div>
            
            <!-- Crude Prices -->
            <h3 class="product-category-header">üõ¢Ô∏è Crude Oil Benchmarks</h3>
            <div class="market-prices">
                <div class="price-card" style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);">
                    <div class="price-label">Brent Crude</div>
                    <div class="price-value">$76.22</div>
                    <div class="price-change">North Sea</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);">
                    <div class="price-label">WTI Crude</div>
                    <div class="price-value">$73.56</div>
                    <div class="price-change">Cushing</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);">
                    <div class="price-label">Dubai Crude</div>
                    <div class="price-value">$75.89</div>
                    <div class="price-change">Middle East</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);">
                    <div class="price-label">Urals</div>
                    <div class="price-value">$60.45</div>
                    <div class="price-change">Russia</div>
                </div>
            </div>
            
            <!-- Light Products -->
            <h3 class="product-category-header">‚ö° Light Products</h3>
            <div class="market-prices">
                <div class="price-card" style="background: linear-gradient(135deg, #56CCF2 0%, #2F80ED 100%);">
                    <div class="price-label">LPG (Propane)</div>
                    <div class="price-value">$45.80</div>
                    <div class="price-change">$/bbl FOB</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #56CCF2 0%, #2F80ED 100%);">
                    <div class="price-label">Light Naphtha</div>
                    <div class="price-value">$78.50</div>
                    <div class="price-change">C5-C6 $/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #56CCF2 0%, #2F80ED 100%);">
                    <div class="price-label">Full Range Naphtha</div>
                    <div class="price-value">$82.15</div>
                    <div class="price-change">$/bbl CIF</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #56CCF2 0%, #2F80ED 100%);">
                    <div class="price-label">Reformate</div>
                    <div class="price-value">$95.30</div>
                    <div class="price-change">95 RON $/bbl</div>
                </div>
            </div>
            
            <!-- Gasoline Grades -->
            <h3 class="product-category-header">‚õΩ Gasoline Products</h3>
            <div class="market-prices">
                <div class="price-card" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                    <div class="price-label">Regular (87 RON)</div>
                    <div class="price-value">$90.30</div>
                    <div class="price-change">RBOB $/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                    <div class="price-label">Premium (92 RON)</div>
                    <div class="price-value">$92.85</div>
                    <div class="price-change">$/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                    <div class="price-label">Super (95 RON)</div>
                    <div class="price-value">$94.50</div>
                    <div class="price-change">$/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                    <div class="price-label">Racing (100 RON)</div>
                    <div class="price-value">$98.20</div>
                    <div class="price-change">$/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                    <div class="price-label">Alkylate</div>
                    <div class="price-value">$105.50</div>
                    <div class="price-change">$/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                    <div class="price-label">MTBE</div>
                    <div class="price-value">$88.75</div>
                    <div class="price-change">$/bbl</div>
                </div>
            </div>
            
            <!-- Middle Distillates -->
            <h3 class="product-category-header">‚úàÔ∏è Middle Distillates</h3>
            <div class="market-prices">
                <div class="price-card" style="background: linear-gradient(135deg, #f2994a 0%, #f2c94c 100%);">
                    <div class="price-label">Kerosene</div>
                    <div class="price-value">$93.20</div>
                    <div class="price-change">$/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #f2994a 0%, #f2c94c 100%);">
                    <div class="price-label">Jet A-1</div>
                    <div class="price-value">$95.50</div>
                    <div class="price-change">$/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #f2994a 0%, #f2c94c 100%);">
                    <div class="price-label">ULSD (10ppm)</div>
                    <div class="price-value">$98.70</div>
                    <div class="price-change">$/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #f2994a 0%, #f2c94c 100%);">
                    <div class="price-label">Diesel (50ppm)</div>
                    <div class="price-value">$96.40</div>
                    <div class="price-change">$/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #f2994a 0%, #f2c94c 100%);">
                    <div class="price-label">Heating Oil</div>
                    <div class="price-value">$94.85</div>
                    <div class="price-change">$/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #f2994a 0%, #f2c94c 100%);">
                    <div class="price-label">Marine Gasoil</div>
                    <div class="price-value">$88.40</div>
                    <div class="price-change">0.5% S $/bbl</div>
                </div>
            </div>
            
            <!-- Heavy Products & Intermediates -->
            <h3 class="product-category-header">üèóÔ∏è Heavy Products & Intermediates</h3>
            <div class="market-prices">
                <div class="price-card" style="background: linear-gradient(135deg, #434343 0%, #000000 100%);">
                    <div class="price-label">VGO</div>
                    <div class="price-value">$68.90</div>
                    <div class="price-change">$/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #434343 0%, #000000 100%);">
                    <div class="price-label">Light Cycle Oil</div>
                    <div class="price-value">$72.30</div>
                    <div class="price-change">$/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #434343 0%, #000000 100%);">
                    <div class="price-label">Heavy Cycle Oil</div>
                    <div class="price-value">$58.20</div>
                    <div class="price-change">$/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #434343 0%, #000000 100%);">
                    <div class="price-label">Coker Gas Oil</div>
                    <div class="price-value">$65.50</div>
                    <div class="price-change">$/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #434343 0%, #000000 100%);">
                    <div class="price-label">Slurry Oil</div>
                    <div class="price-value">$52.15</div>
                    <div class="price-change">$/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #434343 0%, #000000 100%);">
                    <div class="price-label">HSFO (3.5% S)</div>
                    <div class="price-value">$55.40</div>
                    <div class="price-change">380cst $/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #434343 0%, #000000 100%);">
                    <div class="price-label">VLSFO (0.5% S)</div>
                    <div class="price-value">$62.80</div>
                    <div class="price-change">IMO2020 $/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #434343 0%, #000000 100%);">
                    <div class="price-label">Vacuum Residue</div>
                    <div class="price-value">$48.50</div>
                    <div class="price-change">$/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #434343 0%, #000000 100%);">
                    <div class="price-label">Bitumen</div>
                    <div class="price-value">$52.20</div>
                    <div class="price-change">$/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #434343 0%, #000000 100%);">
                    <div class="price-label">Pet Coke (Fuel)</div>
                    <div class="price-value">$25.50</div>
                    <div class="price-change">$/bbl eq</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #434343 0%, #000000 100%);">
                    <div class="price-label">Needle Coke</div>
                    <div class="price-value">$185.00</div>
                    <div class="price-change">$/MT</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #434343 0%, #000000 100%);">
                    <div class="price-label">Sulfur</div>
                    <div class="price-value">$85.00</div>
                    <div class="price-change">$/MT</div>
                </div>
            </div>
            
            <!-- Key Crack Spreads -->
            <h3 class="product-category-header">üìà Key Crack Spreads & Differentials</h3>
            <div class="market-prices">
                <div class="price-card" style="background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);">
                    <div class="price-label">3-2-1 Crack</div>
                    <div class="price-value">$18.50</div>
                    <div class="price-change">$/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);">
                    <div class="price-label">Gasoline Crack</div>
                    <div class="price-value">$14.08</div>
                    <div class="price-change">vs Brent</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);">
                    <div class="price-label">Jet Crack</div>
                    <div class="price-value">$19.28</div>
                    <div class="price-change">vs Brent</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);">
                    <div class="price-label">Diesel Crack</div>
                    <div class="price-value">$22.48</div>
                    <div class="price-change">vs Brent</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);">
                    <div class="price-label">Fuel Oil Crack</div>
                    <div class="price-value">-$20.82</div>
                    <div class="price-change">vs Brent</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);">
                    <div class="price-label">VGO-FO Spread</div>
                    <div class="price-value">$13.50</div>
                    <div class="price-change">$/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);">
                    <div class="price-label">LPG-Naphtha</div>
                    <div class="price-value">-$36.35</div>
                    <div class="price-change">$/bbl</div>
                </div>
                <div class="price-card" style="background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);">
                    <div class="price-label">Brent-Dubai</div>
                    <div class="price-value">$0.33</div>
                    <div class="price-change">EFS $/bbl</div>
                </div>
            </div>
        </div>
        
        <!-- Hot Crudes Section with Yield-Based Margins -->
        <div class="hot-crudes-container">
            <div class="hot-crudes-header">
                <h2 class="hot-crudes-title">
                    <span class="fire-icon">üî•</span>
                    Hot Crudes - Top 10 Most Profitable
                </h2>
            </div>
            
            <!-- Refinery Configuration Tabs -->
            <div class="refinery-tabs">
                <div class="refinery-tab active" onclick="switchRefineryConfig('simple')">
                    üè≠ Simple Refinery<br>
                    <small>(CDU + VDU)</small>
                </div>
                <div class="refinery-tab" onclick="switchRefineryConfig('medium')">
                    üè≠üîß Medium Complexity<br>
                    <small>(CDU + VDU + FCC)</small>
                </div>
                <div class="refinery-tab" onclick="switchRefineryConfig('complex')">
                    üè≠‚ö° Complex Refinery<br>
                    <small>(CDU + VDU + FCC + Coker)</small>
                </div>
            </div>
            
            <!-- Configuration Description -->
            <div id="refineryDescription" class="refinery-description">
                <h4>Simple Refinery Configuration (CDU + VDU Only)</h4>
                <p>This configuration includes only Crude Distillation Unit (CDU) and Vacuum Distillation Unit (VDU). Best suited for light sweet crudes with high natural yields of valuable products. Limited ability to upgrade heavy residues.</p>
            </div>
            
            <!-- Crude Rankings Table with Yield Details -->
            <table class="crude-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Crude Type</th>
                        <th>Origin</th>
                        <th>API/Sulfur</th>
                        <th>CIF Houston</th>
                        <th>Key Yields</th>
                        <th>Revenue/bbl</th>
                        <th>Margin/bbl</th>
                    </tr>
                </thead>
                <tbody id="hotCrudesTable">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <!-- Upgrade Economics Section -->
        <div class="upgrade-section">
            <div class="hot-crudes-header">
                <h2 class="hot-crudes-title">
                    <span style="color: #3498db;">‚ö°</span>
                    Upgrade Economics - FCC + Coker Addition Analysis
                </h2>
            </div>
            
            <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #28a745;">
                <p style="color: #155724; margin: 0;">
                    <strong>Analysis:</strong> Margin improvement from upgrading Simple Refinery (CDU+VDU) to Complex Refinery (CDU+VDU+FCC+Coker)
                </p>
            </div>
            
            <div class="upgrade-grid">
                <!-- Top 5 Winners -->
                <div>
                    <h3 style="color: #27ae60; margin-bottom: 15px;">
                        üìà Top 5 Winners from FCC + Coker Addition
                    </h3>
                    <table class="upgrade-table">
                        <thead>
                            <tr style="background: #27ae60;">
                                <th>Rank</th>
                                <th>Crude</th>
                                <th>Type</th>
                                <th>Margin Gain</th>
                            </tr>
                        </thead>
                        <tbody id="topUpgradeTable">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Bottom 5 -->
                <div>
                    <h3 style="color: #e74c3c; margin-bottom: 15px;">
                        üìâ Bottom 5 - Least Benefit from Upgrade
                    </h3>
                    <table class="upgrade-table">
                        <thead>
                            <tr style="background: #e74c3c;">
                                <th>Rank</th>
                                <th>Crude</th>
                                <th>Type</th>
                                <th>Margin Gain</th>
                            </tr>
                        </thead>
                        <tbody id="bottomUpgradeTable">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Summary Statistics -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 20px;">
                <h4 style="color: #2c3e50; margin-bottom: 15px;">Upgrade Economics Summary</h4>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; text-align: center;">
                    <div>
                        <div style="font-size: 1.5em; font-weight: bold; color: #27ae60;" id="avgHeavyGain">--</div>
                        <div style="color: #7f8c8d; font-size: 0.9em;">Avg Heavy Crude Gain ($/bbl)</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5em; font-weight: bold; color: #f39c12;" id="avgMediumGain">--</div>
                        <div style="color: #7f8c8d; font-size: 0.9em;">Avg Medium Crude Gain ($/bbl)</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5em; font-weight: bold; color: #e74c3c;" id="avgLightGain">--</div>
                        <div style="color: #7f8c8d; font-size: 0.9em;">Avg Light Crude Gain ($/bbl)</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Market Trends Section -->
        <div class="hot-crudes-container" style="margin-top: 30px;">
            <h2 class="hot-crudes-title">üìà Market Trends & Outlook</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #e0e0e0;">
                        <div>
                            <strong>3-2-1 Crack Spread</strong>
                            <div style="font-size: 0.9em; color: #666;">Gulf Coast Benchmark</div>
                        </div>
                        <div style="font-size: 1.2em; font-weight: bold; color: #dc3545;">$14.85/bbl ‚ñº -8.2%</div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #e0e0e0;">
                        <div>
                            <strong>Diesel Crack Spread</strong>
                            <div style="font-size: 0.9em; color: #666;">ULSD vs Brent</div>
                        </div>
                        <div style="font-size: 1.2em; font-weight: bold; color: #28a745;">$22.48/bbl ‚ñ≤ +12.5%</div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px;">
                        <div>
                            <strong>Gasoline Crack Spread</strong>
                            <div style="font-size: 0.9em; color: #666;">RBOB vs Brent</div>
                        </div>
                        <div style="font-size: 1.2em; font-weight: bold; color: #dc3545;">$14.08/bbl ‚ñº -5.3%</div>
                    </div>
                </div>
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #e0e0e0;">
                        <div>
                            <strong>Heavy-Light Differential</strong>
                            <div style="font-size: 0.9em; color: #666;">Maya vs WTI</div>
                        </div>
                        <div style="font-size: 1.2em; font-weight: bold; color: #28a745;">$18.50/bbl ‚ñ≤ +15.2%</div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #e0e0e0;">
                        <div>
                            <strong>Brent-Dubai EFS</strong>
                            <div style="font-size: 0.9em; color: #666;">East-West Spread</div>
                        </div>
                        <div style="font-size: 1.2em; font-weight: bold; color: #ffc107;">$0.33/bbl ‚Üí 0%</div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px;">
                        <div>
                            <strong>WCS Discount</strong>
                            <div style="font-size: 0.9em; color: #666;">vs WTI</div>
                        </div>
                        <div style="font-size: 1.2em; font-weight: bold; color: #dc3545;">$14.75/bbl ‚ñº -3.1%</div>
                    </div>
                </div>
            </div>
            <div style="margin-top: 20px; padding: 15px; background: #f0f0f0; border-radius: 10px;">
                <h4 style="color: #2c3e50; margin-bottom: 10px;">Market Outlook</h4>
                <ul style="color: #666; line-height: 1.8; margin-left: 20px;">
                    <li><strong>Diesel margins strengthening:</strong> Winter demand and tight global inventories supporting crack spreads into Q1 2025</li>
                    <li><strong>Gasoline oversupplied:</strong> High inventories pressuring margins, especially on USWC with renewable competition</li>
                    <li><strong>Heavy crude opportunity:</strong> Widening differentials favor complex refineries with coking capacity</li>
                    <li><strong>IMO 2020 impact:</strong> VLSFO demand stable, HSFO discount narrowing on power generation demand</li>
                </ul>
            </div>
        </div>
        
        <!-- Top Performer Section -->
        <div class="hot-crudes-container" style="margin-top: 30px; background: linear-gradient(135deg, #ffd700 0%, #ffb300 100%); color: white;">
            <h2 style="font-size: 1.8em; margin-bottom: 20px; color: white;">üèÜ Today's Top Performer</h2>
            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 30px;">
                <div style="text-align: center;">
                    <div style="font-size: 3em; margin-bottom: 10px;">ü•á</div>
                    <h3 style="font-size: 1.5em; color: white;" id="topCrudeName">Loading...</h3>
                    <p id="topCrudeOrigin" style="opacity: 0.9; color: white;">-</p>
                </div>
                <div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <div style="font-size: 0.9em; opacity: 0.9;">Margin (Complex)</div>
                            <div style="font-size: 1.8em; font-weight: bold;" id="topMargin">-</div>
                        </div>
                        <div>
                            <div style="font-size: 0.9em; opacity: 0.9;">Best Config</div>
                            <div style="font-size: 1.8em; font-weight: bold;" id="topConfig">Complex</div>
                        </div>
                        <div>
                            <div style="font-size: 0.9em; opacity: 0.9;">API/Sulfur</div>
                            <div style="font-size: 1.3em;" id="topSpecs">-</div>
                        </div>
                        <div>
                            <div style="font-size: 0.9em; opacity: 0.9;">Key Advantage</div>
                            <div style="font-size: 1.3em;" id="topAdvantage">-</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.3);">
                        <p id="topPerformerNote" style="line-height: 1.6; color: white;">-</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Charts Section -->
        <div class="charts-grid">
            <div class="chart-container">
                <h3 class="chart-title">Profitability by Crude Type</h3>
                <div class="chart-wrapper">
                    <canvas id="typeChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <h3 class="chart-title">Product Yield Distribution</h3>
                <div class="chart-wrapper">
                    <canvas id="yieldChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <!-- LP Model Page -->
    <div id="lpModelPage" class="dashboard-container" style="display: none;">
        <div class="hot-crudes-container">
            <h2 class="hot-crudes-title">üìà Linear Programming Optimization Model</h2>
            
            <div class="refinery-description" style="background: #e8f5e9; border-left-color: #4caf50;">
                <h4>Refinery Optimization Tool</h4>
                <p>Optimize crude selection based on refinery configuration and constraints.</p>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                <div>
                    <h3 style="color: #2c3e50; margin-bottom: 20px;">Input Parameters</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Select Crude Oil:</label>
                        <select id="lpCrudeSelect" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="">Choose a crude...</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Processing Volume (bbl/day):</label>
                        <input type="number" id="lpVolume" value="100000" min="1000" max="500000" step="1000" 
                               style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Refinery Configuration:</label>
                        <select id="lpRefineryConfig" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="simple">Simple (CDU + VDU)</option>
                            <option value="medium">Medium (CDU + VDU + FCC)</option>
                            <option value="complex" selected>Complex (CDU + VDU + FCC + Coker)</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <h3 style="color: #2c3e50; margin-bottom: 20px;">Operational Constraints</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Max Sulfur Content (%):</label>
                        <input type="number" id="lpMaxSulfur" value="2.5" min="0.1" max="5.0" step="0.1" 
                               style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Min API Gravity:</label>
                        <input type="number" id="lpMinAPI" value="25" min="10" max="50" step="1" 
                               style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Product Focus:</label>
                        <select id="lpProductFocus" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="balanced">Balanced Yields</option>
                            <option value="gasoline">Max Gasoline</option>
                            <option value="distillate">Max Distillate</option>
                            <option value="jet">Max Jet Fuel</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <button onclick="runLPOptimization()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px 40px; border-radius: 8px; font-size: 1.1em; font-weight: 600; cursor: pointer; margin-bottom: 30px;">
                üîÑ Run Optimization
            </button>
            
            <div id="lpResults" style="display: none;"></div>
        </div>
    </div>
    
    <!-- Blending Calculator Page -->
    <div id="blendingPage" class="dashboard-container" style="display: none;">
        <div class="hot-crudes-container">
            <h2 class="hot-crudes-title">‚öóÔ∏è Crude Oil Blending Calculator</h2>
            
            <div class="refinery-description" style="background: #fce4ec; border-left-color: #e91e63;">
                <h4>Blend Optimization Tool</h4>
                <p>Calculate optimal blend ratios and evaluate compatibility.</p>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h3 style="color: #2c3e50; margin-bottom: 20px;">Component 1</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Select Crude:</label>
                        <select id="blendCrude1" onchange="updateBlendInfo(1)" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="">Choose first crude...</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Blend Percentage (%):</label>
                        <input type="range" id="blendPercent1" value="50" min="0" max="100" step="1" 
                               oninput="updateBlendPercentages(1)" style="width: 100%;">
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <span>0%</span>
                            <span id="blendPercent1Value" style="font-weight: bold; color: #667eea;">50%</span>
                            <span>100%</span>
                        </div>
                    </div>
                    
                    <div id="crude1Info" style="background: white; padding: 15px; border-radius: 8px; font-size: 0.9em;">
                        <em style="color: #999;">Select a crude to see properties</em>
                    </div>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h3 style="color: #2c3e50; margin-bottom: 20px;">Component 2</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Select Crude:</label>
                        <select id="blendCrude2" onchange="updateBlendInfo(2)" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="">Choose second crude...</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Blend Percentage (%):</label>
                        <input type="range" id="blendPercent2" value="50" min="0" max="100" step="1" 
                               oninput="updateBlendPercentages(2)" style="width: 100%;">
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <span>0%</span>
                            <span id="blendPercent2Value" style="font-weight: bold; color: #764ba2;">50%</span>
                            <span>100%</span>
                        </div>
                    </div>
                    
                    <div id="crude2Info" style="background: white; padding: 15px; border-radius: 8px; font-size: 0.9em;">
                        <em style="color: #999;">Select a crude to see properties</em>
                    </div>
                </div>
            </div>
            
            <div style="background: #fff3e0; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: #2c3e50; margin-bottom: 15px;">Processing Parameters</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <div>
                        <label style="font-weight: 600;">Total Volume (bbl/day):</label>
                        <input type="number" id="blendVolume" value="50000" step="1000" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="font-weight: 600;">Optimization Target:</label>
                        <select id="optimizationTarget" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="balanced">Balanced Yield</option>
                            <option value="maxGasoline">Max Gasoline</option>
                            <option value="maxDistillate">Max Distillate</option>
                            <option value="maxJet">Max Jet Fuel</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-weight: 600;">Refinery Config:</label>
                        <select id="blendRefineryConfig" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="simple">Simple (CDU+VDU)</option>
                            <option value="medium">Medium (+ FCC)</option>
                            <option value="complex">Complex (+ Coker)</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <button onclick="calculateBlend()" style="background: linear-gradient(135deg, #e91e63 0%, #f06292 100%); color: white; border: none; padding: 15px 40px; border-radius: 8px; font-size: 1.1em; font-weight: 600; cursor: pointer; margin-bottom: 30px;">
                üß™ Calculate Blend Properties
            </button>
            
            <div id="blendResults" style="display: none;"></div>
            
            <!-- Custom Crude Addition Section -->
            <div style="background: #e8eaf6; padding: 25px; border-radius: 15px; margin-top: 40px;">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">‚ûï Add Custom Crude Oil</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9em;">Crude Name:</label>
                        <input type="text" id="customName" placeholder="e.g., Bakken" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9em;">Origin:</label>
                        <input type="text" id="customOrigin" placeholder="e.g., North Dakota" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9em;">API Gravity:</label>
                        <input type="number" id="customAPI" placeholder="e.g., 42.5" step="0.1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9em;">Sulfur (%):</label>
                        <input type="number" id="customSulfur" placeholder="e.g., 0.18" step="0.01" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                </div>
                
                <h4 style="color: #2c3e50; margin: 20px 0 10px 0;">Product Yields (% by volume):</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 0.85em;">LPG:</label>
                        <input type="number" id="yieldLPG" placeholder="2.5" step="0.1" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 0.85em;">Naphtha:</label>
                        <input type="number" id="yieldNaphtha" placeholder="20" step="0.1" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 0.85em;">Gasoline:</label>
                        <input type="number" id="yieldGasoline" placeholder="22" step="0.1" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 0.85em;">Kerosene:</label>
                        <input type="number" id="yieldKerosene" placeholder="8" step="0.1" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 0.85em;">Jet:</label>
                        <input type="number" id="yieldJet" placeholder="7" step="0.1" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 0.85em;">Diesel:</label>
                        <input type="number" id="yieldDiesel" placeholder="18" step="0.1" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 0.85em;">VGO:</label>
                        <input type="number" id="yieldVGO" placeholder="10" step="0.1" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 0.85em;">Residual:</label>
                        <input type="number" id="yieldResidual" placeholder="12.5" step="0.1" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div id="yieldSum" style="color: #666; font-size: 0.9em;">Total Yield: 0%</div>
                    <button onclick="addCustomCrude()" style="background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%); color: white; border: none; padding: 10px 30px; border-radius: 6px; font-weight: 600; cursor: pointer;">
                        ‚úÖ Add Custom Crude
                    </button>
                </div>
            </div>
            
            <!-- Model Assumptions Section -->
            <div style="background: #f5f5f5; padding: 25px; border-radius: 15px; margin-top: 40px;">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">üìã Model Assumptions & Parameters</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    <div>
                        <h4 style="color: #34495e; margin-bottom: 15px;">Refinery Configuration Assumptions</h4>
                        <ul style="color: #666; font-size: 0.9em; line-height: 1.8;">
                            <li><strong>Simple Refinery:</strong> CDU + VDU only, no conversion units</li>
                            <li><strong>FCC Unit:</strong> Processes 100% of VGO, 50% gasoline yield, 30% LCO, 15% HCO, 5% gas</li>
                            <li><strong>Delayed Coker:</strong> Processes vacuum residue, 30% naphtha, 40% gas oil, 20% coke, 10% gas</li>
                            <li><strong>Secondary FCC:</strong> 50% of coker gas oil can be reprocessed</li>
                            <li><strong>Sulfur Recovery:</strong> Credit of $2.50/bbl for crudes >1.0% sulfur in complex refineries</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 style="color: #34495e; margin-bottom: 15px;">Economic Assumptions</h4>
                        <ul style="color: #666; font-size: 0.9em; line-height: 1.8;">
                            <li><strong>Base Crude Cost:</strong> $75/bbl (adjustable in calculations)</li>
                            <li><strong>Product Pricing:</strong> Based on current market differentials to Brent</li>
                            <li><strong>Operating Costs:</strong> Not included (gross margin basis)</li>
                            <li><strong>Transportation:</strong> FOB refinery gate pricing</li>
                            <li><strong>Quality Premiums:</strong> Not applied (base spec products)</li>
                        </ul>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
                    <h4 style="color: #34495e; margin-bottom: 15px;">Blending Compatibility Assessment</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h5 style="color: #666; margin-bottom: 10px;">Physical Properties</h5>
                            <ul style="color: #666; font-size: 0.9em; line-height: 1.8;">
                                <li><strong>API Gravity:</strong> Blends non-linearly by specific gravity</li>
                                <li><strong>Sulfur:</strong> Linear blending by weight percentage</li>
                                <li><strong>Viscosity:</strong> Logarithmic blending (Refutas equation)</li>
                                <li><strong>Pour Point:</strong> Non-linear, approaches higher value</li>
                                <li><strong>TAN:</strong> Linear by weight for acid number</li>
                                <li><strong>Metals (V/Ni):</strong> Linear by weight (ppm basis)</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: #666; margin-bottom: 10px;">SARA Fractions & Stability</h5>
                            <ul style="color: #666; font-size: 0.9em; line-height: 1.8;">
                                <li><strong>Saturates/Aromatics/Resins/Asphaltenes:</strong> Linear by weight</li>
                                <li><strong>Colloidal Instability Index (CII):</strong> (S+As)/(Ar+R) < 0.9 for stability</li>
                                <li><strong>Asphaltene/Resin Ratio:</strong> < 0.5 optimal solvation</li>
                                <li><strong>P-Value:</strong> > 1.0 indicates asphaltene stability</li>
                                <li><strong>Critical Mechanism:</strong> Paraffinic + Asphaltic = Precipitation risk</li>
                                <li><strong>Testing Standards:</strong> ASTM D7061, D4740, D8253</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; padding: 15px; background: #fff3e0; border-radius: 8px;">
                        <h5 style="color: #e65100; margin-bottom: 10px;">Compatibility Risk Thresholds</h5>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; font-size: 0.85em; color: #666;">
                            <div><strong>API Differential:</strong> >15¬∞ = High risk</div>
                            <div><strong>Viscosity Ratio:</strong> >5:1 = Poor mixing</div>
                            <div><strong>Pour Point Diff:</strong> >15¬∞C = Wax issues</div>
                            <div><strong>CII Value:</strong> >0.9 = Unstable</div>
                            <div><strong>As/R Ratio:</strong> >0.8 = Poor solvation</div>
                            <div><strong>P-Value:</strong> <1.0 = Precipitation</div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
                    <h4 style="color: #34495e; margin-bottom: 15px;">Processing Assumptions</h4>
                    <ul style="color: #666; font-size: 0.9em; line-height: 1.8;">
                        <li><strong>Linear Blending:</strong> API gravity and sulfur blend linearly by volume</li>
                        <li><strong>Compatibility:</strong> Based on API differential (>15¬∞ = poor, 8-15¬∞ = good, <8¬∞ = excellent)</li>
                        <li><strong>Yield Blending:</strong> Product yields blend linearly by volume percentage</li>
                        <li><strong>No Volume Swell/Shrinkage:</strong> 1:1 volume addition assumed</li>
                        <li><strong>Homogeneous Mixing:</strong> Perfect mixing assumed, no stratification</li>
                    </ul>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #fff9c4; border-radius: 8px;">
                    <p style="margin: 0; color: #666; font-size: 0.85em;">
                        <strong>Note:</strong> This model provides directional guidance for refinery economics. Actual results will vary based on specific refinery configuration, local market conditions, operational efficiency, and crude quality variations. Consult with refinery planning teams for detailed optimization.
                    </p>
                </div>
            </div>
            
            <div id="blendResults" style="display: none;"></div>
        </div>
    </div>
    
    <!-- Custom Crude Entry Page -->
    <div id="customCrudePage" class="dashboard-container" style="display: none;">
        <div class="hot-crudes-container">
            <h2 class="hot-crudes-title">‚ûï Add Custom Crude Oil</h2>
            
            <div class="refinery-description" style="background: #e1f5fe; border-left-color: #03a9f4;">
                <h4>Custom Crude Database</h4>
                <p>Add your own crude oil specifications to the database for analysis in all tools.</p>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                <div>
                    <h3 style="color: #2c3e50; margin-bottom: 20px;">Basic Properties</h3>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Crude Name:</label>
                        <input type="text" id="customName" placeholder="e.g., Kashagan" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Origin/Country:</label>
                        <input type="text" id="customOrigin" placeholder="e.g., Kazakhstan" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">API Gravity:</label>
                        <input type="number" id="customAPI" placeholder="e.g., 45.5" step="0.1" min="10" max="60" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Sulfur Content (%):</label>
                        <input type="number" id="customSulfur" placeholder="e.g., 0.75" step="0.01" min="0" max="6" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                </div>
                
                <div>
                    <h3 style="color: #2c3e50; margin-bottom: 20px;">Product Yields (%)</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>
                            <label style="font-size: 0.9em;">LPG:</label>
                            <input type="number" id="yieldLPG" placeholder="2.5" step="0.1" min="0" max="10" style="width: 100%; padding: 5px;">
                        </div>
                        <div>
                            <label style="font-size: 0.9em;">Naphtha:</label>
                            <input type="number" id="yieldNaphtha" placeholder="25.0" step="0.1" min="0" max="40" style="width: 100%; padding: 5px;">
                        </div>
                        <div>
                            <label style="font-size: 0.9em;">Gasoline:</label>
                            <input type="number" id="yieldGasoline" placeholder="22.0" step="0.1" min="0" max="40" style="width: 100%; padding: 5px;">
                        </div>
                        <div>
                            <label style="font-size: 0.9em;">Kerosene:</label>
                            <input type="number" id="yieldKerosene" placeholder="8.0" step="0.1" min="0" max="20" style="width: 100%; padding: 5px;">
                        </div>
                        <div>
                            <label style="font-size: 0.9em;">Jet Fuel:</label>
                            <input type="number" id="yieldJet" placeholder="7.0" step="0.1" min="0" max="20" style="width: 100%; padding: 5px;">
                        </div>
                        <div>
                            <label style="font-size: 0.9em;">Diesel:</label>
                            <input type="number" id="yieldDiesel" placeholder="17.0" step="0.1" min="0" max="30" style="width: 100%; padding: 5px;">
                        </div>
                        <div>
                            <label style="font-size: 0.9em;">VGO:</label>
                            <input type="number" id="yieldVGO" placeholder="8.0" step="0.1" min="0" max="25" style="width: 100%; padding: 5px;">
                        </div>
                        <div>
                            <label style="font-size: 0.9em;">Residual:</label>
                            <input type="number" id="yieldResidual" placeholder="10.5" step="0.1" min="0" max="60" style="width: 100%; padding: 5px;">
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; padding: 10px; background: #f0f0f0; border-radius: 5px;">
                        <strong>Total Yield: <span id="totalYield" style="color: #e74c3c;">0.0%</span></strong>
                        <div style="font-size: 0.85em; color: #666; margin-top: 5px;">Must equal 100% ¬± 2%</div>
                    </div>
                </div>
            </div>
            
            <button onclick="addCustomCrude()" style="background: linear-gradient(135deg, #03a9f4 0%, #00bcd4 100%); color: white; border: none; padding: 15px 40px; border-radius: 8px; font-size: 1.1em; font-weight: 600; cursor: pointer; margin-bottom: 20px;">
                ‚ûï Add Crude to Database
            </button>
            
            <button onclick="clearCustomForm()" style="background: #6c757d; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 1em; cursor: pointer; margin-left: 10px;">
                üîÑ Clear Form
            </button>
            
            <div id="customCrudeList" style="margin-top: 30px;">
                <h3 style="color: #2c3e50; margin-bottom: 15px;">Custom Crudes Added This Session</h3>
                <div id="customCrudeTable" style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                    <em style="color: #999;">No custom crudes added yet</em>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Assumptions Page -->
    <div id="assumptionsPage" class="dashboard-container" style="display: none;">
        <div class="hot-crudes-container">
            <h2 class="hot-crudes-title">üìã Model Assumptions & Settings</h2>
            
            <div class="refinery-description" style="background: #fff9c4; border-left-color: #fbc02d;">
                <h4>Dashboard Configuration</h4>
                <p>Adjust key assumptions and parameters used throughout the refinery analytics dashboard.</p>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <div>
                    <h3 style="color: #2c3e50; margin-bottom: 20px;">Economic Assumptions</h3>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Base Crude Cost ($/bbl):</label>
                            <input type="number" id="baseCrudeCost" value="75" step="1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Operating Cost ($/bbl):</label>
                            <input type="number" id="operatingCost" value="5" step="0.5" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Sulfur Penalty Factor:</label>
                            <input type="number" id="sulfurPenalty" value="2" step="0.5" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            <small style="color: #666;">$/bbl per % sulfur</small>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">API Gravity Bonus:</label>
                            <input type="number" id="apiBonus" value="0.5" step="0.1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            <small style="color: #666;">$/bbl per degree API above 30</small>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 style="color: #2c3e50; margin-bottom: 20px;">Processing Yields</h3>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        <h4 style="font-size: 1em; margin-bottom: 10px;">FCC Unit Yields</h4>
                        <div style="margin-bottom: 10px;">
                            <label style="font-size: 0.9em;">Gasoline Yield (%):</label>
                            <input type="number" id="fccGasoline" value="50" step="1" min="40" max="60" style="width: 80px; margin-left: 10px; padding: 5px;">
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="font-size: 0.9em;">LCO Yield (%):</label>
                            <input type="number" id="fccLCO" value="30" step="1" min="20" max="40" style="width: 80px; margin-left: 10px; padding: 5px;">
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="font-size: 0.9em;">HCO Yield (%):</label>
                            <input type="number" id="fccHCO" value="15" step="1" min="10" max="20" style="width: 80px; margin-left: 10px; padding: 5px;">
                        </div>
                        
                        <h4 style="font-size: 1em; margin: 20px 0 10px 0;">Coker Unit Yields</h4>
                        <div style="margin-bottom: 10px;">
                            <label style="font-size: 0.9em;">Naphtha Yield (%):</label>
                            <input type="number" id="cokerNaphtha" value="30" step="1" min="20" max="40" style="width: 80px; margin-left: 10px; padding: 5px;">
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="font-size: 0.9em;">Gas Oil Yield (%):</label>
                            <input type="number" id="cokerGasOil" value="40" step="1" min="30" max="50" style="width: 80px; margin-left: 10px; padding: 5px;">
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="font-size: 0.9em;">Coke Yield (%):</label>
                            <input type="number" id="cokerCoke" value="20" step="1" min="15" max="30" style="width: 80px; margin-left: 10px; padding: 5px;">
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 30px;">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">Default Product Prices ($/bbl)</h3>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <label style="font-size: 0.9em;">Gasoline (87 RON):</label>
                            <input type="number" id="priceGasoline" value="90.30" step="0.5" style="width: 100px; margin-left: 10px; padding: 5px;">
                        </div>
                        <div>
                            <label style="font-size: 0.9em;">Jet Fuel:</label>
                            <input type="number" id="priceJet" value="95.50" step="0.5" style="width: 100px; margin-left: 10px; padding: 5px;">
                        </div>
                        <div>
                            <label style="font-size: 0.9em;">ULSD:</label>
                            <input type="number" id="priceULSD" value="98.70" step="0.5" style="width: 100px; margin-left: 10px; padding: 5px;">
                        </div>
                        <div>
                            <label style="font-size: 0.9em;">Naphtha:</label>
                            <input type="number" id="priceNaphtha" value="82.15" step="0.5" style="width: 100px; margin-left: 10px; padding: 5px;">
                        </div>
                        <div>
                            <label style="font-size: 0.9em;">VGO:</label>
                            <input type="number" id="priceVGO" value="68.90" step="0.5" style="width: 100px; margin-left: 10px; padding: 5px;">
                        </div>
                        <div>
                            <label style="font-size: 0.9em;">Fuel Oil:</label>
                            <input type="number" id="priceFuelOil" value="55.40" step="0.5" style="width: 100px; margin-left: 10px; padding: 5px;">
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 30px; text-align: center;">
                <button onclick="saveAssumptions()" style="background: linear-gradient(135deg, #4caf50 0%, #45a049 100%); color: white; border: none; padding: 15px 40px; border-radius: 8px; font-size: 1.1em; font-weight: 600; cursor: pointer; margin-right: 10px;">
                    üíæ Save Settings
                </button>
                <button onclick="resetAssumptions()" style="background: #f44336; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 1em; cursor: pointer;">
                    ‚Ü∫ Reset to Defaults
                </button>
            </div>
            
            <div id="assumptionsStatus" style="margin-top: 20px;"></div>
        </div>
    </div>
    
    <script>
        // Comprehensive crude database with detailed yields and compatibility properties
        const crudeDatabase = [
            // Light Sweet Crudes
            { name: 'Tapis', origin: 'Malaysia', api: 45.5, sulfur: 0.03, type: 'Light Sweet', 
              yields: {lpg: 0.03, naphtha: 0.28, gasoline: 0.25, kerosene: 0.10, jet: 0.08, diesel: 0.14, vgo: 0.05, residual: 0.07},
              sara: {saturates: 0.62, aromatics: 0.28, resins: 0.08, asphaltenes: 0.02},
              viscosity: 3.2, pourPoint: -15, tan: 0.05, vanadium: 2, nickel: 4,
              transportCost: 4.50}, // Asia-Pacific to Houston
            { name: 'Bonny Light', origin: 'Nigeria', api: 35.4, sulfur: 0.14, type: 'Light Sweet',
              yields: {lpg: 0.02, naphtha: 0.23, gasoline: 0.21, kerosene: 0.08, jet: 0.07, diesel: 0.17, vgo: 0.08, residual: 0.14},
              sara: {saturates: 0.55, aromatics: 0.30, resins: 0.11, asphaltenes: 0.04},
              viscosity: 4.8, pourPoint: -12, tan: 0.08, vanadium: 5, nickel: 8,
              transportCost: 2.80}, // West Africa to Houston
            { name: 'WTI', origin: 'USA', api: 39.6, sulfur: 0.24, type: 'Light Sweet',
              yields: {lpg: 0.025, naphtha: 0.25, gasoline: 0.23, kerosene: 0.09, jet: 0.07, diesel: 0.16, vgo: 0.07, residual: 0.105},
              sara: {saturates: 0.58, aromatics: 0.29, resins: 0.10, asphaltenes: 0.03},
              viscosity: 4.0, pourPoint: -18, tan: 0.07, vanadium: 3, nickel: 6,
              transportCost: 0.75}, // Domestic pipeline/barge
            { name: 'Brent', origin: 'North Sea', api: 38.3, sulfur: 0.37, type: 'Light Sweet',
              yields: {lpg: 0.02, naphtha: 0.24, gasoline: 0.22, kerosene: 0.08, jet: 0.07, diesel: 0.17, vgo: 0.08, residual: 0.12},
              sara: {saturates: 0.56, aromatics: 0.29, resins: 0.11, asphaltenes: 0.04},
              viscosity: 4.3, pourPoint: -16, tan: 0.09, vanadium: 4, nickel: 7,
              transportCost: 2.60}, // North Sea to Houston
            
            // Light Sour Crudes  
            { name: 'Arab Light', origin: 'Saudi Arabia', api: 33.0, sulfur: 1.77, type: 'Light Sour',
              yields: {lpg: 0.015, naphtha: 0.21, gasoline: 0.19, kerosene: 0.07, jet: 0.07, diesel: 0.17, vgo: 0.10, residual: 0.175},
              sara: {saturates: 0.50, aromatics: 0.31, resins: 0.13, asphaltenes: 0.06},
              viscosity: 5.6, pourPoint: -10, tan: 0.12, vanadium: 8, nickel: 15,
              transportCost: 3.20}, // Middle East to Houston
            { name: 'Kuwait Export', origin: 'Kuwait', api: 31.4, sulfur: 2.52, type: 'Light Sour',
              yields: {lpg: 0.015, naphtha: 0.20, gasoline: 0.18, kerosene: 0.06, jet: 0.07, diesel: 0.16, vgo: 0.11, residual: 0.205},
              sara: {saturates: 0.48, aromatics: 0.32, resins: 0.14, asphaltenes: 0.06},
              viscosity: 6.2, pourPoint: -8, tan: 0.15, vanadium: 12, nickel: 18,
              transportCost: 3.30}, // Middle East to Houston
            { name: 'Murban', origin: 'UAE', api: 40.5, sulfur: 0.78, type: 'Light Sour',
              yields: {lpg: 0.025, naphtha: 0.25, gasoline: 0.22, kerosene: 0.09, jet: 0.07, diesel: 0.17, vgo: 0.06, residual: 0.095},
              sara: {saturates: 0.54, aromatics: 0.30, resins: 0.12, asphaltenes: 0.04},
              viscosity: 3.8, pourPoint: -14, tan: 0.10, vanadium: 6, nickel: 10,
              transportCost: 3.40}, // Middle East to Houston
            
            // Heavy Sweet Crudes
            { name: 'Forcados', origin: 'Nigeria', api: 29.7, sulfur: 0.22, type: 'Heavy Sweet',
              yields: {lpg: 0.01, naphtha: 0.19, gasoline: 0.17, kerosene: 0.06, jet: 0.06, diesel: 0.16, vgo: 0.12, residual: 0.23},
              sara: {saturates: 0.45, aromatics: 0.32, resins: 0.16, asphaltenes: 0.07},
              viscosity: 8.5, pourPoint: -5, tan: 0.18, vanadium: 15, nickel: 22,
              transportCost: 2.80}, // West Africa to Houston
            { name: 'Dalia', origin: 'Angola', api: 23.5, sulfur: 0.48, type: 'Heavy Sweet',
              yields: {lpg: 0.008, naphtha: 0.15, gasoline: 0.14, kerosene: 0.05, jet: 0.05, diesel: 0.15, vgo: 0.15, residual: 0.302},
              sara: {saturates: 0.40, aromatics: 0.33, resins: 0.18, asphaltenes: 0.09},
              viscosity: 15.2, pourPoint: -2, tan: 0.22, vanadium: 25, nickel: 35,
              transportCost: 2.90}, // West Africa to Houston
            
            // Heavy Sour Crudes
            { name: 'Maya', origin: 'Mexico', api: 21.8, sulfur: 3.30, type: 'Heavy Sour',
              yields: {lpg: 0.007, naphtha: 0.14, gasoline: 0.13, kerosene: 0.04, jet: 0.05, diesel: 0.14, vgo: 0.16, residual: 0.333},
              sara: {saturates: 0.35, aromatics: 0.34, resins: 0.20, asphaltenes: 0.11},
              viscosity: 22.5, pourPoint: 3, tan: 0.35, vanadium: 50, nickel: 65,
              transportCost: 1.20}, // Mexico to Houston
            { name: 'Arab Heavy', origin: 'Saudi Arabia', api: 27.7, sulfur: 2.80, type: 'Heavy Sour',
              yields: {lpg: 0.01, naphtha: 0.17, gasoline: 0.15, kerosene: 0.05, jet: 0.06, diesel: 0.15, vgo: 0.13, residual: 0.26},
              sara: {saturates: 0.42, aromatics: 0.33, resins: 0.17, asphaltenes: 0.08},
              viscosity: 12.8, pourPoint: 0, tan: 0.25, vanadium: 30, nickel: 40,
              transportCost: 3.30}, // Middle East to Houston
            { name: 'Basrah Heavy', origin: 'Iraq', api: 24.7, sulfur: 3.95, type: 'Heavy Sour',
              yields: {lpg: 0.008, naphtha: 0.16, gasoline: 0.14, kerosene: 0.05, jet: 0.05, diesel: 0.14, vgo: 0.14, residual: 0.302},
              sara: {saturates: 0.38, aromatics: 0.34, resins: 0.19, asphaltenes: 0.09},
              viscosity: 18.5, pourPoint: 5, tan: 0.32, vanadium: 45, nickel: 55,
              transportCost: 3.50}, // Middle East to Houston
            { name: 'Venezuelan Merey', origin: 'Venezuela', api: 16.0, sulfur: 2.45, type: 'Extra Heavy',
              yields: {lpg: 0.005, naphtha: 0.10, gasoline: 0.10, kerosene: 0.03, jet: 0.04, diesel: 0.12, vgo: 0.18, residual: 0.405},
              sara: {saturates: 0.30, aromatics: 0.35, resins: 0.22, asphaltenes: 0.13},
              viscosity: 35.0, pourPoint: 10, tan: 0.45, vanadium: 85, nickel: 95,
              transportCost: 1.80}, // Venezuela to Houston
            
            // Medium Crudes
            { name: 'Es Sider', origin: 'Libya', api: 37.0, sulfur: 0.44, type: 'Light Sweet',
              yields: {lpg: 0.02, naphtha: 0.24, gasoline: 0.21, kerosene: 0.08, jet: 0.07, diesel: 0.17, vgo: 0.08, residual: 0.13},
              sara: {saturates: 0.54, aromatics: 0.30, resins: 0.12, asphaltenes: 0.04},
              viscosity: 4.6, pourPoint: -12, tan: 0.11, vanadium: 7, nickel: 12,
              transportCost: 2.40}, // Mediterranean to Houston
            { name: 'Urals', origin: 'Russia', api: 31.8, sulfur: 1.35, type: 'Medium Sour',
              yields: {lpg: 0.015, naphtha: 0.20, gasoline: 0.19, kerosene: 0.06, jet: 0.07, diesel: 0.16, vgo: 0.10, residual: 0.195},
              sara: {saturates: 0.49, aromatics: 0.31, resins: 0.14, asphaltenes: 0.06},
              viscosity: 6.8, pourPoint: -6, tan: 0.16, vanadium: 18, nickel: 28,
              transportCost: 3.60}, // Russia to Houston
            { name: 'Dubai', origin: 'UAE', api: 31.0, sulfur: 2.00, type: 'Medium Sour',
              yields: {lpg: 0.015, naphtha: 0.20, gasoline: 0.18, kerosene: 0.06, jet: 0.07, diesel: 0.16, vgo: 0.11, residual: 0.205},
              sara: {saturates: 0.47, aromatics: 0.32, resins: 0.15, asphaltenes: 0.06},
              viscosity: 7.2, pourPoint: -4, tan: 0.14, vanadium: 20, nickel: 30,
              transportCost: 3.40} // Middle East to Houston
        ];
        
        // Current market prices for all products
        const marketPrices = {
            // Crudes
            brent: 76.22,
            wti: 73.56,
            dubai: 75.89,
            
            // Light Products
            lpg: 45.80,
            lightNaphtha: 78.50,
            naphtha: 82.15,
            reformate: 95.30,
            
            // Gasoline
            gasoline87: 90.30,
            gasoline92: 92.85,
            gasoline95: 94.50,
            alkylate: 105.50,
            
            // Middle Distillates
            kerosene: 93.20,
            jet: 95.50,
            ulsd: 98.70,
            diesel50: 96.40,
            heatingOil: 94.85,
            marineGasoil: 88.40,
            
            // Heavy Products
            vgo: 68.90,
            lco: 72.30,
            hco: 58.20,
            cgo: 65.50,
            hsfo: 55.40,
            vlsfo: 62.80,
            vacuumResidue: 48.50,
            coke: 25.50,
            sulfur: 2.50 // $/bbl equivalent
        };
        
        let currentConfig = 'simple';
        
        // Custom Crudes array
        let customCrudes = [];
        
        // Get current assumptions - defined early as it's used by multiple functions
        function getAssumptions() {
            return {
                baseCrudeCost: (document.getElementById('baseCrudeCost') && document.getElementById('baseCrudeCost').value) || 75,
                operatingCost: (document.getElementById('operatingCost') && document.getElementById('operatingCost').value) || 5,
                sulfurPenalty: (document.getElementById('sulfurPenalty') && document.getElementById('sulfurPenalty').value) || 2,
                apiBonus: (document.getElementById('apiBonus') && document.getElementById('apiBonus').value) || 0.5,
                fccGasoline: (document.getElementById('fccGasoline') && document.getElementById('fccGasoline').value) || 50,
                fccLCO: (document.getElementById('fccLCO') && document.getElementById('fccLCO').value) || 30,
                fccHCO: (document.getElementById('fccHCO') && document.getElementById('fccHCO').value) || 15,
                cokerNaphtha: (document.getElementById('cokerNaphtha') && document.getElementById('cokerNaphtha').value) || 30,
                cokerGasOil: (document.getElementById('cokerGasOil') && document.getElementById('cokerGasOil').value) || 40,
                cokerCoke: (document.getElementById('cokerCoke') && document.getElementById('cokerCoke').value) || 20
            };
        }
        
        // Calculate crude margin with actual product yields
        function calculateCrudeMarginWithYields(crude, config) {
            let revenue = 0;
            const yields = {...crude.yields};
            
            // Transform yields based on refinery configuration
            if (config === 'simple') {
                // Simple refinery - natural yields only
                revenue += yields.lpg * marketPrices.lpg;
                revenue += yields.naphtha * marketPrices.naphtha;
                revenue += yields.gasoline * marketPrices.gasoline87;
                revenue += yields.kerosene * marketPrices.kerosene;
                revenue += yields.jet * marketPrices.jet;
                revenue += yields.diesel * marketPrices.diesel50;
                revenue += yields.vgo * marketPrices.vgo;
                revenue += yields.residual * marketPrices.hsfo;
                
            } else if (config === 'medium') {
                // FCC processes VGO
                const fccFeed = yields.vgo;
                const fccGasoline = fccFeed * 0.50;
                const fccLCO = fccFeed * 0.30;
                const fccHCO = fccFeed * 0.15;
                const fccLPG = fccFeed * 0.05;
                
                revenue += (yields.lpg + fccLPG) * marketPrices.lpg;
                revenue += yields.naphtha * marketPrices.naphtha;
                revenue += (yields.gasoline + fccGasoline) * marketPrices.gasoline87;
                revenue += yields.kerosene * marketPrices.kerosene;
                revenue += yields.jet * marketPrices.jet;
                revenue += (yields.diesel + fccLCO) * marketPrices.diesel50;
                revenue += fccHCO * marketPrices.hco;
                revenue += yields.residual * marketPrices.hsfo;
                
            } else if (config === 'complex') {
                // FCC processes VGO
                const fccFeed = yields.vgo;
                const fccGasoline = fccFeed * 0.50;
                const fccLCO = fccFeed * 0.30;
                const fccHCO = fccFeed * 0.15;
                const fccLPG = fccFeed * 0.05;
                
                // Coker processes residual
                const cokerFeed = yields.residual;
                const cokerGas = cokerFeed * 0.10;
                const cokerNaphtha = cokerFeed * 0.30;
                const cokerGasOil = cokerFeed * 0.40;
                const cokerCoke = cokerFeed * 0.20;
                
                // Secondary FCC of half the coker gas oil
                const secondaryFCC = cokerGasOil * 0.5;
                const secondaryGasoline = secondaryFCC * 0.45;
                const secondaryDiesel = secondaryFCC * 0.35;
                
                revenue += (yields.lpg + fccLPG + cokerGas) * marketPrices.lpg;
                revenue += (yields.naphtha + cokerNaphtha) * marketPrices.naphtha;
                revenue += (yields.gasoline + fccGasoline + secondaryGasoline) * marketPrices.gasoline87;
                revenue += yields.kerosene * marketPrices.kerosene;
                revenue += yields.jet * marketPrices.jet;
                revenue += (yields.diesel + fccLCO + cokerGasOil * 0.5 + secondaryDiesel) * marketPrices.diesel50;
                revenue += fccHCO * marketPrices.hco;
                revenue += cokerCoke * marketPrices.coke;
                
                // Sulfur recovery credit for sour crudes
                if (crude.sulfur > 1.0) {
                    revenue += crude.sulfur * marketPrices.sulfur;
                }
            }
            
            // Calculate margin with CIF Houston delivery
            const baseAssumptions = getAssumptions();
            const crudeFOBCost = parseFloat(baseAssumptions.baseCrudeCost) || 75;
            const transportCost = crude.transportCost || 0;
            const operatingCost = parseFloat(baseAssumptions.operatingCost) || 5;
            const sulfurPenalty = (parseFloat(baseAssumptions.sulfurPenalty) || 2) * crude.sulfur;
            const apiBonus = crude.api > 30 ? (parseFloat(baseAssumptions.apiBonus) || 0.5) * (crude.api - 30) : 0;
            
            const totalCost = crudeFOBCost + transportCost + operatingCost + sulfurPenalty - apiBonus;
            const margin = revenue - totalCost;
            
            return { margin, revenue };
        }
        
        // Update hot crudes table with yield information
        function updateHotCrudesWithYields(config) {
            const tbody = document.getElementById('hotCrudesTable');
            tbody.innerHTML = '';
            
            // Calculate margins for all crudes
            const crudesWithMargins = crudeDatabase.map(crude => {
                const result = calculateCrudeMarginWithYields(crude, config);
                return {
                    ...crude,
                    margin: result.margin,
                    revenue: result.revenue
                };
            });
            
            // Sort by margin
            crudesWithMargins.sort((a, b) => b.margin - a.margin);
            
            // Display top 10
            crudesWithMargins.slice(0, 10).forEach((crude, index) => {
                const row = tbody.insertRow();
                
                // Determine badge class
                let badgeClass = 'rank-badge';
                if (index === 0) badgeClass += ' gold-badge';
                else if (index === 1) badgeClass += ' silver-badge';
                else if (index === 2) badgeClass += ' bronze-badge';
                
                // Format key yields based on config
                let keyYields = '';
                if (config === 'simple') {
                    keyYields = `Gas: ${(crude.yields.gasoline * 100).toFixed(0)}%, Dist: ${((crude.yields.diesel + crude.yields.jet) * 100).toFixed(0)}%, FO: ${(crude.yields.residual * 100).toFixed(0)}%`;
                } else if (config === 'medium') {
                    const totalGasoline = crude.yields.gasoline + crude.yields.vgo * 0.5;
                    const totalDistillate = crude.yields.diesel + crude.yields.jet + crude.yields.vgo * 0.3;
                    const totalFO = crude.yields.residual + crude.yields.vgo * 0.15;
                    keyYields = `Gas: ${(totalGasoline * 100).toFixed(0)}%, Dist: ${(totalDistillate * 100).toFixed(0)}%, FO: ${(totalFO * 100).toFixed(0)}%`;
                } else {
                    const totalGasoline = crude.yields.gasoline + crude.yields.vgo * 0.5 + crude.yields.residual * 0.3;
                    const totalDistillate = crude.yields.diesel + crude.yields.jet + crude.yields.vgo * 0.3 + crude.yields.residual * 0.3;
                    keyYields = `Gas: ${(totalGasoline * 100).toFixed(0)}%, Dist: ${(totalDistillate * 100).toFixed(0)}%, Coke: ${(crude.yields.residual * 0.2 * 100).toFixed(0)}%`;
                }
                
                const baseAssumptions = getAssumptions();
                const crudeFOBCost = parseFloat(baseAssumptions.baseCrudeCost) || 75;
                const cifHouston = crudeFOBCost + crude.transportCost;
                
                row.innerHTML = `
                    <td><span class="${badgeClass}">#${index + 1}</span></td>
                    <td><strong>${crude.name}</strong></td>
                    <td>${crude.origin}</td>
                    <td>${crude.api.toFixed(1)}¬∞/${crude.sulfur.toFixed(2)}%</td>
                    <td>$${cifHouston.toFixed(2)}</td>
                    <td style="font-size: 0.85em;">${keyYields}</td>
                    <td>$${crude.revenue.toFixed(2)}</td>
                    <td><strong style="color: ${crude.margin > 0 ? '#27ae60' : '#e74c3c'}">$${crude.margin.toFixed(2)}</strong></td>
                `;
            });
        }
        
        // Switch refinery configuration
        function switchRefineryConfig(config) {
            currentConfig = config;
            
            // Update active tab
            document.querySelectorAll('.refinery-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.closest('.refinery-tab').classList.add('active');
            
            // Update description
            const descriptions = {
                simple: {
                    title: 'Simple Refinery Configuration (CDU + VDU Only)',
                    text: 'This configuration includes only Crude Distillation Unit (CDU) and Vacuum Distillation Unit (VDU). Best suited for light sweet crudes with high natural yields of valuable products. Limited ability to upgrade heavy residues.'
                },
                medium: {
                    title: 'Medium Complexity Refinery (CDU + VDU + FCC)',
                    text: 'Includes Fluid Catalytic Cracking (FCC) unit in addition to CDU and VDU. Can upgrade vacuum gas oil to gasoline, improving margins on medium gravity crudes. Better suited for crudes with moderate residue content.'
                },
                complex: {
                    title: 'Complex Refinery (CDU + VDU + FCC + Coker)',
                    text: 'Full conversion refinery with Delayed Coking unit. Can process heavy, high-sulfur crudes economically by converting residues to lighter products. Maximum flexibility and margin capture on discounted heavy crudes.'
                }
            };
            
            const desc = descriptions[config];
            document.getElementById('refineryDescription').innerHTML = `
                <h4>${desc.title}</h4>
                <p>${desc.text}</p>
            `;
            
            // Update hot crudes ranking
            updateHotCrudesWithYields(config);
            updateUpgradeEconomics();
            updateTopPerformer();
        }
        
        // Update upgrade economics
        function updateUpgradeEconomics() {
            // Calculate margin improvement for each crude
            const upgradeAnalysis = crudeDatabase.map(crude => {
                const simpleResult = calculateCrudeMarginWithYields(crude, 'simple');
                const complexResult = calculateCrudeMarginWithYields(crude, 'complex');
                const marginGain = complexResult.margin - simpleResult.margin;
                
                // Determine crude classification
                let classification = '';
                if (crude.api < 28) {
                    classification = crude.sulfur < 0.5 ? 'Heavy Sweet' : 'Heavy Sour';
                } else if (crude.api <= 34) {
                    classification = crude.sulfur < 1.0 ? 'Medium Sweet' : 'Medium Sour';
                } else {
                    classification = crude.sulfur < 0.5 ? 'Light Sweet' : 'Light Sour';
                }
                
                return {
                    name: crude.name,
                    classification: classification,
                    marginGain: marginGain
                };
            });
            
            // Sort by margin gain
            upgradeAnalysis.sort((a, b) => b.marginGain - a.marginGain);
            
            // Display top 5 winners
            const topTable = document.getElementById('topUpgradeTable');
            topTable.innerHTML = '';
            upgradeAnalysis.slice(0, 5).forEach((crude, index) => {
                const row = topTable.insertRow();
                row.innerHTML = `
                    <td><strong>#${index + 1}</strong></td>
                    <td>${crude.name}</td>
                    <td><small>${crude.classification}</small></td>
                    <td style="color: #27ae60; font-weight: bold;">+$${crude.marginGain.toFixed(2)}</td>
                `;
            });
            
            // Display bottom 5
            const bottomTable = document.getElementById('bottomUpgradeTable');
            bottomTable.innerHTML = '';
            upgradeAnalysis.slice(-5).reverse().forEach((crude, index) => {
                const row = bottomTable.insertRow();
                row.innerHTML = `
                    <td><strong>#${5 - index}</strong></td>
                    <td>${crude.name}</td>
                    <td><small>${crude.classification}</small></td>
                    <td style="color: ${crude.marginGain > 0 ? '#f39c12' : '#e74c3c'}; font-weight: bold;">
                        ${crude.marginGain >= 0 ? '+' : ''}$${crude.marginGain.toFixed(2)}
                    </td>
                `;
            });
            
            // Calculate averages by crude type
            const heavyCrudes = upgradeAnalysis.filter(c => 
                c.classification.includes('Heavy'));
            const mediumCrudes = upgradeAnalysis.filter(c => 
                c.classification.includes('Medium'));
            const lightCrudes = upgradeAnalysis.filter(c => 
                c.classification.includes('Light'));
            
            const avgHeavyGain = heavyCrudes.length > 0 
                ? heavyCrudes.reduce((sum, c) => sum + c.marginGain, 0) / heavyCrudes.length 
                : 0;
            const avgMediumGain = mediumCrudes.length > 0
                ? mediumCrudes.reduce((sum, c) => sum + c.marginGain, 0) / mediumCrudes.length
                : 0;
            const avgLightGain = lightCrudes.length > 0
                ? lightCrudes.reduce((sum, c) => sum + c.marginGain, 0) / lightCrudes.length
                : 0;
            
            document.getElementById('avgHeavyGain').textContent = `+$${avgHeavyGain.toFixed(2)}`;
            document.getElementById('avgMediumGain').textContent = `+$${avgMediumGain.toFixed(2)}`;
            document.getElementById('avgLightGain').textContent = `+$${avgLightGain.toFixed(2)}`;
        }
        
        // Update top performer
        function updateTopPerformer() {
            const crudesWithMargins = crudeDatabase.map(crude => {
                const result = calculateCrudeMarginWithYields(crude, 'complex');
                return {...crude, margin: result.margin, revenue: result.revenue};
            });
            
            crudesWithMargins.sort((a, b) => b.margin - a.margin);
            const topCrude = crudesWithMargins[0];
            
            if (topCrude) {
                document.getElementById('topCrudeName').textContent = topCrude.name;
                document.getElementById('topCrudeOrigin').textContent = topCrude.origin;
                document.getElementById('topMargin').textContent = `+$${topCrude.margin.toFixed(2)}/bbl`;
                document.getElementById('topSpecs').textContent = `${topCrude.api.toFixed(1)}¬∞ / ${topCrude.sulfur.toFixed(2)}%`;
                document.getElementById('topAdvantage').textContent = topCrude.type;
                
                const note = topCrude.api > 40 ? 
                    'Exceptional light sweet crude with minimal residue and high valuable distillate yields.' :
                    topCrude.api < 25 ? 
                    'Heavy crude maximizing value through coking and upgrading operations.' :
                    'Well-balanced crude with strong middle distillate yields.';
                document.getElementById('topPerformerNote').textContent = note;
            }
        }
        
        // Initialize charts
        function initializeCharts() {
            // Check if Chart.js is loaded
            if (typeof Chart === 'undefined') {
                console.error('Chart.js is not loaded');
                return;
            }
            
            // Profitability by Crude Type Chart
            const typeCanvas = document.getElementById('typeChart');
            if (!typeCanvas) {
                console.error('typeChart canvas not found');
                return;
            }
            
            const typeCtx = typeCanvas.getContext('2d');
            
            // Calculate average margins by type for current config
            const typeMargins = {};
            const typeCounts = {};
            
            crudeDatabase.forEach(crude => {
                const result = calculateCrudeMarginWithYields(crude, currentConfig);
                if (!typeMargins[crude.type]) {
                    typeMargins[crude.type] = 0;
                    typeCounts[crude.type] = 0;
                }
                typeMargins[crude.type] += result.margin;
                typeCounts[crude.type]++;
            });
            
            const types = Object.keys(typeMargins);
            const avgMargins = types.map(type => typeMargins[type] / typeCounts[type]);
            
            new Chart(typeCtx, {
                type: 'bar',
                data: {
                    labels: types,
                    datasets: [{
                        label: 'Average Margin ($/bbl)',
                        data: avgMargins,
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(118, 75, 162, 0.8)',
                            'rgba(237, 100, 166, 0.8)',
                            'rgba(255, 159, 64, 0.8)',
                            'rgba(75, 192, 192, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
            
            // Product Yield Chart (example for Brent)
            const yieldCanvas = document.getElementById('yieldChart');
            if (!yieldCanvas) {
                console.error('yieldChart canvas not found');
                return;
            }
            const yieldCtx = yieldCanvas.getContext('2d');
            const brent = crudeDatabase.find(c => c.name === 'Brent');
            
            new Chart(yieldCtx, {
                type: 'pie',
                data: {
                    labels: ['LPG', 'Naphtha', 'Gasoline', 'Jet/Kero', 'Diesel', 'VGO', 'Residual'],
                    datasets: [{
                        data: [
                            brent.yields.lpg * 100,
                            brent.yields.naphtha * 100,
                            brent.yields.gasoline * 100,
                            (brent.yields.kerosene + brent.yields.jet) * 100,
                            brent.yields.diesel * 100,
                            brent.yields.vgo * 100,
                            brent.yields.residual * 100
                        ],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 206, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)',
                            'rgba(153, 102, 255, 0.8)',
                            'rgba(255, 159, 64, 0.8)',
                            'rgba(100, 100, 100, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Typical Yield Distribution (Brent Crude)'
                        }
                    }
                }
            });
        }
        
        // Navigation functions
        function showDashboard() {
            document.getElementById('dashboardPage').style.display = 'block';
            document.getElementById('lpModelPage').style.display = 'none';
            document.getElementById('blendingPage').style.display = 'none';
            document.getElementById('customCrudePage').style.display = 'none';
            document.getElementById('assumptionsPage').style.display = 'none';
        }
        
        function showLPModel() {
            document.getElementById('dashboardPage').style.display = 'none';
            document.getElementById('lpModelPage').style.display = 'block';
            document.getElementById('blendingPage').style.display = 'none';
            document.getElementById('customCrudePage').style.display = 'none';
            document.getElementById('assumptionsPage').style.display = 'none';
            populateLPDropdowns();
        }
        
        function showBlendingCalc() {
            document.getElementById('dashboardPage').style.display = 'none';
            document.getElementById('lpModelPage').style.display = 'none';
            document.getElementById('blendingPage').style.display = 'block';
            document.getElementById('customCrudePage').style.display = 'none';
            document.getElementById('assumptionsPage').style.display = 'none';
            populateBlendingDropdowns();
        }
        
        function showCustomCrude() {
            document.getElementById('dashboardPage').style.display = 'none';
            document.getElementById('lpModelPage').style.display = 'none';
            document.getElementById('blendingPage').style.display = 'none';
            document.getElementById('customCrudePage').style.display = 'block';
            document.getElementById('assumptionsPage').style.display = 'none';
        }
        
        function showAssumptions() {
            document.getElementById('dashboardPage').style.display = 'none';
            document.getElementById('lpModelPage').style.display = 'none';
            document.getElementById('blendingPage').style.display = 'none';
            document.getElementById('customCrudePage').style.display = 'none';
            document.getElementById('assumptionsPage').style.display = 'block';
        }
        
        // Populate LP Model dropdowns
        function populateLPDropdowns() {
            const select = document.getElementById('lpCrudeSelect');
            if (select && select.options.length === 1) {
                crudeDatabase.forEach(crude => {
                    const option = document.createElement('option');
                    option.value = crude.name;
                    option.textContent = `${crude.name} (${crude.origin}) - API: ${crude.api.toFixed(1)}¬∞, S: ${crude.sulfur.toFixed(2)}%`;
                    select.appendChild(option);
                });
            }
        }
        
        // Populate Blending Calculator dropdowns
        function populateBlendingDropdowns() {
            const selects = ['blendCrude1', 'blendCrude2'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select && select.options.length === 1) {
                    crudeDatabase.forEach(crude => {
                        const option = document.createElement('option');
                        option.value = crude.name;
                        option.textContent = `${crude.name} (${crude.origin})`;
                        select.appendChild(option);
                    });
                }
            });
        }
        
        // Run LP Optimization
        function runLPOptimization() {
            const selectedCrude = document.getElementById('lpCrudeSelect').value;
            const volume = parseFloat(document.getElementById('lpVolume').value);
            const config = document.getElementById('lpRefineryConfig').value;
            const maxSulfur = parseFloat(document.getElementById('lpMaxSulfur').value);
            const minAPI = parseFloat(document.getElementById('lpMinAPI').value);
            const productFocus = document.getElementById('lpProductFocus').value;
            
            if (!selectedCrude) {
                alert('Please select a crude oil');
                return;
            }
            
            const crude = crudeDatabase.find(c => c.name === selectedCrude);
            
            // Check constraints
            const constraintViolations = [];
            if (crude.sulfur > maxSulfur) {
                constraintViolations.push(`Sulfur content (${crude.sulfur.toFixed(2)}%) exceeds maximum (${maxSulfur}%)`);
            }
            if (crude.api < minAPI) {
                constraintViolations.push(`API gravity (${crude.api.toFixed(1)}¬∞) below minimum (${minAPI}¬∞)`);
            }
            
            // Calculate yields based on configuration
            const result = calculateCrudeMarginWithYields(crude, config);
            const actualYields = getActualYields(crude, config);
            
            // Calculate product volumes
            const productVolumes = {
                lpg: actualYields.lpg * volume,
                naphtha: actualYields.naphtha * volume,
                gasoline: actualYields.gasoline * volume,
                jet: actualYields.jet * volume,
                diesel: actualYields.diesel * volume,
                fuelOil: actualYields.fuelOil * volume,
                coke: actualYields.coke * volume
            };
            
            // Calculate economics
            const totalRevenue = result.revenue * volume;
            const totalCost = 75 * volume; // Crude cost
            const totalMargin = result.margin * volume;
            
            // Generate results HTML
            const resultsHTML = `
                <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
                    <h3 style="color: #2c3e50; margin-bottom: 20px;">Optimization Results</h3>
                    
                    ${constraintViolations.length > 0 ? `
                    <div style="background: #fee; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #e74c3c;">
                        <h4 style="color: #c0392b; margin-bottom: 10px;">‚ö†Ô∏è Constraint Violations</h4>
                        ${constraintViolations.map(v => `<p style="margin: 5px 0;">‚Ä¢ ${v}</p>`).join('')}
                    </div>` : `
                    <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #28a745;">
                        <h4 style="color: #155724; margin-bottom: 5px;">‚úÖ All Constraints Met</h4>
                    </div>`}
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                        <div>
                            <h4 style="color: #34495e; margin-bottom: 15px;">Crude Properties</h4>
                            <table style="width: 100%; font-size: 0.95em;">
                                <tr><td style="padding: 8px; border-bottom: 1px solid #eee;"><strong>Crude:</strong></td><td>${crude.name}</td></tr>
                                <tr><td style="padding: 8px; border-bottom: 1px solid #eee;"><strong>Origin:</strong></td><td>${crude.origin}</td></tr>
                                <tr><td style="padding: 8px; border-bottom: 1px solid #eee;"><strong>API Gravity:</strong></td><td>${crude.api.toFixed(1)}¬∞</td></tr>
                                <tr><td style="padding: 8px; border-bottom: 1px solid #eee;"><strong>Sulfur:</strong></td><td>${crude.sulfur.toFixed(2)}%</td></tr>
                                <tr><td style="padding: 8px;"><strong>Type:</strong></td><td>${crude.type}</td></tr>
                            </table>
                        </div>
                        
                        <div>
                            <h4 style="color: #34495e; margin-bottom: 15px;">Processing Parameters</h4>
                            <table style="width: 100%; font-size: 0.95em;">
                                <tr><td style="padding: 8px; border-bottom: 1px solid #eee;"><strong>Configuration:</strong></td><td>${config.charAt(0).toUpperCase() + config.slice(1)}</td></tr>
                                <tr><td style="padding: 8px; border-bottom: 1px solid #eee;"><strong>Volume:</strong></td><td>${volume.toLocaleString()} bbl/day</td></tr>
                                <tr><td style="padding: 8px; border-bottom: 1px solid #eee;"><strong>Product Focus:</strong></td><td>${productFocus.charAt(0).toUpperCase() + productFocus.slice(1)}</td></tr>
                                <tr><td style="padding: 8px; border-bottom: 1px solid #eee;"><strong>Max Sulfur:</strong></td><td>${maxSulfur}%</td></tr>
                                <tr><td style="padding: 8px;"><strong>Min API:</strong></td><td>${minAPI}¬∞</td></tr>
                            </table>
                        </div>
                    </div>
                    
                    <h4 style="color: #34495e; margin: 30px 0 15px 0;">Product Yields</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        ${actualYields.lpg > 0.001 ? `
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 0.9em; color: #666;">LPG</div>
                            <div style="font-size: 1.2em; font-weight: bold; color: #1976d2;">${(actualYields.lpg * 100).toFixed(1)}%</div>
                            <div style="font-size: 0.85em; color: #666;">${productVolumes.lpg.toLocaleString()} bbl/day</div>
                        </div>` : ''}
                        
                        <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 0.9em; color: #666;">Naphtha</div>
                            <div style="font-size: 1.2em; font-weight: bold; color: #388e3c;">${(actualYields.naphtha * 100).toFixed(1)}%</div>
                            <div style="font-size: 0.85em; color: #666;">${productVolumes.naphtha.toLocaleString()} bbl/day</div>
                        </div>
                        
                        <div style="background: #fff3e0; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 0.9em; color: #666;">Gasoline</div>
                            <div style="font-size: 1.2em; font-weight: bold; color: #f57c00;">${(actualYields.gasoline * 100).toFixed(1)}%</div>
                            <div style="font-size: 0.85em; color: #666;">${productVolumes.gasoline.toLocaleString()} bbl/day</div>
                        </div>
                        
                        <div style="background: #fce4ec; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 0.9em; color: #666;">Jet Fuel</div>
                            <div style="font-size: 1.2em; font-weight: bold; color: #c2185b;">${(actualYields.jet * 100).toFixed(1)}%</div>
                            <div style="font-size: 0.85em; color: #666;">${productVolumes.jet.toLocaleString()} bbl/day</div>
                        </div>
                        
                        <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 0.9em; color: #666;">Diesel</div>
                            <div style="font-size: 1.2em; font-weight: bold; color: #7b1fa2;">${(actualYields.diesel * 100).toFixed(1)}%</div>
                            <div style="font-size: 0.85em; color: #666;">${productVolumes.diesel.toLocaleString()} bbl/day</div>
                        </div>
                        
                        <div style="background: #e0e0e0; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 0.9em; color: #666;">Fuel Oil</div>
                            <div style="font-size: 1.2em; font-weight: bold; color: #616161;">${(actualYields.fuelOil * 100).toFixed(1)}%</div>
                            <div style="font-size: 0.85em; color: #666;">${productVolumes.fuelOil.toLocaleString()} bbl/day</div>
                        </div>
                        
                        ${actualYields.coke > 0.001 ? `
                        <div style="background: #efebe9; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 0.9em; color: #666;">Pet Coke</div>
                            <div style="font-size: 1.2em; font-weight: bold; color: #5d4037;">${(actualYields.coke * 100).toFixed(1)}%</div>
                            <div style="font-size: 0.85em; color: #666;">${productVolumes.coke.toLocaleString()} bbl/day</div>
                        </div>` : ''}
                    </div>
                    
                    <h4 style="color: #34495e; margin: 30px 0 15px 0;">Economic Summary</h4>
                    <div style="background: linear-gradient(to right, #f8f9fa, #e9ecef); padding: 20px; border-radius: 10px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; text-align: center;">
                            <div>
                                <div style="font-size: 0.9em; color: #666;">Daily Revenue</div>
                                <div style="font-size: 1.5em; font-weight: bold; color: #28a745;">$${totalRevenue.toLocaleString()}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.9em; color: #666;">Daily Cost</div>
                                <div style="font-size: 1.5em; font-weight: bold; color: #dc3545;">$${totalCost.toLocaleString()}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.9em; color: #666;">Daily Margin</div>
                                <div style="font-size: 1.5em; font-weight: bold; color: #007bff;">$${totalMargin.toLocaleString()}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.9em; color: #666;">Margin per Barrel</div>
                                <div style="font-size: 1.5em; font-weight: bold; color: #6610f2;">$${result.margin.toFixed(2)}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('lpResults').innerHTML = resultsHTML;
            document.getElementById('lpResults').style.display = 'block';
        }
        
        // Get actual yields for a configuration
        function getActualYields(crude, config) {
            const yields = {
                lpg: 0,
                naphtha: crude.yields.naphtha,
                gasoline: crude.yields.gasoline,
                jet: crude.yields.jet + crude.yields.kerosene,
                diesel: crude.yields.diesel,
                fuelOil: crude.yields.residual,
                coke: 0
            };
            
            if (config === 'medium') {
                // FCC processing
                const fccFeed = crude.yields.vgo;
                yields.lpg = crude.yields.lpg + fccFeed * 0.05;
                yields.gasoline += fccFeed * 0.50;
                yields.diesel += fccFeed * 0.30;
                yields.fuelOil = crude.yields.residual + fccFeed * 0.15;
            } else if (config === 'complex') {
                // FCC + Coker processing
                const fccFeed = crude.yields.vgo;
                const cokerFeed = crude.yields.residual;
                
                yields.lpg = crude.yields.lpg + fccFeed * 0.05 + cokerFeed * 0.10;
                yields.naphtha += cokerFeed * 0.30;
                yields.gasoline += fccFeed * 0.50 + cokerFeed * 0.20 * 0.45;
                yields.diesel += fccFeed * 0.30 + cokerFeed * 0.20 + cokerFeed * 0.20 * 0.35;
                yields.fuelOil = fccFeed * 0.15;
                yields.coke = cokerFeed * 0.20;
            } else {
                yields.lpg = crude.yields.lpg;
            }
            
            return yields;
        }
        
        // Update blend percentages
        function updateBlendPercentages(component) {
            const percent1 = document.getElementById('blendPercent1');
            const percent2 = document.getElementById('blendPercent2');
            
            if (component === 1) {
                percent2.value = 100 - percent1.value;
            } else {
                percent1.value = 100 - percent2.value;
            }
            
            document.getElementById('blendPercent1Value').textContent = percent1.value + '%';
            document.getElementById('blendPercent2Value').textContent = percent2.value + '%';
        }
        
        // Update blend crude info
        function updateBlendInfo(component) {
            const selectId = component === 1 ? 'blendCrude1' : 'blendCrude2';
            const infoId = component === 1 ? 'crude1Info' : 'crude2Info';
            
            const crudeName = document.getElementById(selectId).value;
            if (!crudeName) {
                document.getElementById(infoId).innerHTML = '<em style="color: #999;">Select a crude to see properties</em>';
                return;
            }
            
            const crude = crudeDatabase.find(c => c.name === crudeName);
            const baseAssumptions = getAssumptions();
            const crudeFOBCost = parseFloat(baseAssumptions.baseCrudeCost) || 75;
            const cifHoustonCost = crudeFOBCost + crude.transportCost;
            
            document.getElementById(infoId).innerHTML = `
                <div style="font-size: 0.85em;">
                    <div style="margin-bottom: 5px;"><strong>API:</strong> ${crude.api.toFixed(1)}¬∞</div>
                    <div style="margin-bottom: 5px;"><strong>Sulfur:</strong> ${crude.sulfur.toFixed(2)}%</div>
                    <div style="margin-bottom: 5px;"><strong>Type:</strong> ${crude.type}</div>
                    <div style="margin-bottom: 5px; color: #2c5aa0;"><strong>CIF Houston:</strong> $${cifHoustonCost.toFixed(2)}/bbl</div>
                    <div style="margin-bottom: 5px; font-size: 0.8em; color: #666;">(FOB $${crudeFOBCost} + Transport $${crude.transportCost.toFixed(2)})</div>
                    <div><strong>Key Yields:</strong> Gas ${(crude.yields.gasoline * 100).toFixed(0)}%, Dist ${((crude.yields.diesel + crude.yields.jet) * 100).toFixed(0)}%</div>
                </div>
            `;
        }
        
        // Calculate blend properties
        function calculateBlend() {
            const crude1Name = document.getElementById('blendCrude1').value;
            const crude2Name = document.getElementById('blendCrude2').value;
            const percent1 = parseFloat(document.getElementById('blendPercent1').value) / 100;
            const percent2 = parseFloat(document.getElementById('blendPercent2').value) / 100;
            const volumeElement = document.getElementById('blendVolume');
            const volume = volumeElement ? parseFloat(volumeElement.value) : 50000;
            const optimizationTarget = document.getElementById('optimizationTarget').value;
            const refineryConfig = document.getElementById('blendRefineryConfig').value;
            
            if (!crude1Name || !crude2Name) {
                alert('Please select both crudes');
                return;
            }
            
            const crude1 = crudeDatabase.find(c => c.name === crude1Name);
            const crude2 = crudeDatabase.find(c => c.name === crude2Name);
            
            // Calculate blend properties
            const blendAPI = crude1.api * percent1 + crude2.api * percent2;
            const blendSulfur = crude1.sulfur * percent1 + crude2.sulfur * percent2;
            const blendTransportCost = crude1.transportCost * percent1 + crude2.transportCost * percent2;
            
            // Calculate base blend yields
            const baseBlendYields = {};
            Object.keys(crude1.yields).forEach(product => {
                baseBlendYields[product] = crude1.yields[product] * percent1 + crude2.yields[product] * percent2;
            });
            
            // Apply optimization adjustments to yields
            const optimizedYields = {...baseBlendYields};
            let optimizationNote = '';
            
            if (refineryConfig === 'medium' || refineryConfig === 'complex') {
                switch(optimizationTarget) {
                    case 'maxGasoline':
                        // Maximize gasoline: FCC in max gasoline mode, minimal diesel cuts
                        if (refineryConfig === 'medium' || refineryConfig === 'complex') {
                            const vgoToGasoline = optimizedYields.vgo * 0.60; // Higher gasoline yield from FCC
                            const vgoToLCO = optimizedYields.vgo * 0.25; // Less diesel
                            optimizedYields.gasoline += vgoToGasoline;
                            optimizedYields.diesel += vgoToLCO;
                            optimizedYields.vgo = optimizedYields.vgo * 0.15; // Remaining heavy cycle oil
                            
                            // Naphtha reforming for more gasoline
                            const naphthaReformed = optimizedYields.naphtha * 0.30;
                            optimizedYields.gasoline += naphthaReformed * 0.85;
                            optimizedYields.naphtha -= naphthaReformed;
                        }
                        optimizationNote = 'FCC maximized for gasoline production, naphtha reforming active';
                        break;
                        
                    case 'maxDistillate':
                        // Maximize diesel: FCC in max distillate mode
                        if (refineryConfig === 'medium' || refineryConfig === 'complex') {
                            const vgoToGasoline = optimizedYields.vgo * 0.35; // Less gasoline
                            const vgoToLCO = optimizedYields.vgo * 0.50; // Maximum diesel
                            optimizedYields.gasoline += vgoToGasoline;
                            optimizedYields.diesel += vgoToLCO;
                            optimizedYields.vgo = optimizedYields.vgo * 0.15;
                            
                            // Convert some kerosene to diesel pool
                            const keroToDiesel = optimizedYields.kerosene * 0.50;
                            optimizedYields.diesel += keroToDiesel;
                            optimizedYields.kerosene -= keroToDiesel;
                        }
                        optimizationNote = 'FCC in max distillate mode, kerosene to diesel pool';
                        break;
                        
                    case 'maxJet':
                        // Maximize jet fuel: Optimize kerosene and jet cuts
                        const naphthaToJet = optimizedYields.naphtha * 0.15;
                        optimizedYields.jet += naphthaToJet;
                        optimizedYields.naphtha -= naphthaToJet;
                        
                        // Convert light diesel to jet pool
                        const dieselToJet = optimizedYields.diesel * 0.20;
                        optimizedYields.jet += dieselToJet;
                        optimizedYields.diesel -= dieselToJet;
                        
                        // Maximize kerosene/jet cut
                        optimizedYields.jet += optimizedYields.kerosene * 0.80;
                        optimizedYields.kerosene *= 0.20;
                        optimizationNote = 'Maximized jet fuel cuts, expanded kerosene range';
                        break;
                        
                    default: // balanced
                        // Standard FCC operation
                        if (refineryConfig === 'medium' || refineryConfig === 'complex') {
                            const vgoToGasoline = optimizedYields.vgo * 0.50;
                            const vgoToLCO = optimizedYields.vgo * 0.30;
                            optimizedYields.gasoline += vgoToGasoline;
                            optimizedYields.diesel += vgoToLCO;
                            optimizedYields.vgo = optimizedYields.vgo * 0.20;
                        }
                        optimizationNote = 'Balanced yield optimization';
                }
            }
            
            // Apply complex refinery coker if selected
            if (refineryConfig === 'complex') {
                const residToProducts = optimizedYields.residual * 0.70; // 70% of residue upgraded
                optimizedYields.naphtha += residToProducts * 0.25;
                optimizedYields.diesel += residToProducts * 0.35;
                optimizedYields.gasoline += residToProducts * 0.15;
                optimizedYields.residual *= 0.30; // Only 30% remains as heavy residue/coke
                optimizationNote += ' + Coker processing heavy residue';
            }
            
            // Calculate blend margin with CIF Houston costs
            const baseAssumptions = getAssumptions();
            const crudeFOBCost = parseFloat(baseAssumptions.baseCrudeCost) || 75;
            const operatingCost = parseFloat(baseAssumptions.operatingCost) || 5;
            const sulfurPenalty = (parseFloat(baseAssumptions.sulfurPenalty) || 2) * blendSulfur;
            const apiBonus = blendAPI > 30 ? (parseFloat(baseAssumptions.apiBonus) || 0.5) * (blendAPI - 30) : 0;
            
            const totalCrudeCost = crudeFOBCost + blendTransportCost + operatingCost + sulfurPenalty - apiBonus;
            
            // Calculate revenue from optimized yields
            let revenue = 0;
            revenue += optimizedYields.lpg * marketPrices.lpg;
            revenue += optimizedYields.naphtha * marketPrices.naphtha;
            revenue += optimizedYields.gasoline * marketPrices.gasoline87;
            revenue += optimizedYields.kerosene * marketPrices.kerosene;
            revenue += optimizedYields.jet * marketPrices.jet;
            revenue += optimizedYields.diesel * marketPrices.diesel50;
            revenue += optimizedYields.vgo * marketPrices.vgo;
            revenue += optimizedYields.residual * marketPrices.hsfo;
            
            const margin = revenue - totalCrudeCost;
            
            // Determine compatibility
            const apiDiff = Math.abs(crude1.api - crude2.api);
            let compatibility = 'Excellent';
            let compatibilityColor = '#28a745';
            if (apiDiff > 15) {
                compatibility = 'Poor - Risk of Separation';
                compatibilityColor = '#dc3545';
            } else if (apiDiff > 8) {
                compatibility = 'Good';
                compatibilityColor = '#ffc107';
            }
            
            // Determine blend classification
            const blendClass = blendAPI > 31.1 ? 'Light' : 'Heavy';
            const blendSweet = blendSulfur < 0.5 ? 'Sweet' : 'Sour';
            
            // Generate results HTML
            const resultsHTML = `
                <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); margin-top: 30px;">
                    <h3 style="color: #2c3e50; margin-bottom: 20px;">Blend Analysis Results</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                            <h4 style="color: #667eea; margin-bottom: 10px;">Component 1</h4>
                            <div style="font-size: 1.2em; font-weight: bold;">${crude1.name}</div>
                            <div style="font-size: 2em; font-weight: bold; color: #667eea; margin: 10px 0;">${(percent1 * 100).toFixed(0)}%</div>
                            <div style="font-size: 0.9em; color: #666;">${(volume * percent1).toLocaleString()} bbl/day</div>
                            <div style="font-size: 0.85em; color: #999; margin-top: 5px;">CIF Houston: $${(crudeFOBCost + crude1.transportCost).toFixed(2)}/bbl</div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 10px; text-align: center; color: white;">
                            <div style="font-size: 1.5em; margin-bottom: 10px;">‚ûï</div>
                            <div style="font-size: 1.1em; font-weight: bold;">BLEND</div>
                            <div style="font-size: 0.9em; margin-top: 10px;">Total Volume</div>
                            <div style="font-size: 1.2em; font-weight: bold;">${volume.toLocaleString()} bbl/day</div>
                            <div style="font-size: 0.85em; margin-top: 5px;">CIF Houston: $${totalCrudeCost.toFixed(2)}/bbl</div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                            <h4 style="color: #764ba2; margin-bottom: 10px;">Component 2</h4>
                            <div style="font-size: 1.2em; font-weight: bold;">${crude2.name}</div>
                            <div style="font-size: 2em; font-weight: bold; color: #764ba2; margin: 10px 0;">${(percent2 * 100).toFixed(0)}%</div>
                            <div style="font-size: 0.9em; color: #666;">${(volume * percent2).toLocaleString()} bbl/day</div>
                            <div style="font-size: 0.85em; color: #999; margin-top: 5px;">CIF Houston: $${(crudeFOBCost + crude2.transportCost).toFixed(2)}/bbl</div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                        <div>
                            <h4 style="color: #34495e; margin-bottom: 15px;">Blend Properties</h4>
                            <table style="width: 100%;">
                                <tr style="border-bottom: 2px solid #dee2e6;">
                                    <td style="padding: 10px;"><strong>Property</strong></td>
                                    <td style="padding: 10px; text-align: center;"><strong>Blend</strong></td>
                                    <td style="padding: 10px; text-align: center;">${crude1.name}</td>
                                    <td style="padding: 10px; text-align: center;">${crude2.name}</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 10px;">API Gravity</td>
                                    <td style="padding: 10px; text-align: center; font-weight: bold;">${blendAPI.toFixed(1)}¬∞</td>
                                    <td style="padding: 10px; text-align: center;">${crude1.api.toFixed(1)}¬∞</td>
                                    <td style="padding: 10px; text-align: center;">${crude2.api.toFixed(1)}¬∞</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 10px;">Sulfur Content</td>
                                    <td style="padding: 10px; text-align: center; font-weight: bold;">${blendSulfur.toFixed(2)}%</td>
                                    <td style="padding: 10px; text-align: center;">${crude1.sulfur.toFixed(2)}%</td>
                                    <td style="padding: 10px; text-align: center;">${crude2.sulfur.toFixed(2)}%</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px;">Classification</td>
                                    <td style="padding: 10px; text-align: center; font-weight: bold;">${blendClass} ${blendSweet}</td>
                                    <td style="padding: 10px; text-align: center; font-size: 0.9em;">${crude1.type}</td>
                                    <td style="padding: 10px; text-align: center; font-size: 0.9em;">${crude2.type}</td>
                                </tr>
                            </table>
                        </div>
                        
                        <div>
                            <h4 style="color: #34495e; margin-bottom: 15px;">Compatibility Assessment</h4>
                            <div style="background: ${compatibilityColor}20; border: 2px solid ${compatibilityColor}; padding: 20px; border-radius: 10px; text-align: center;">
                                <div style="font-size: 1.5em; font-weight: bold; color: ${compatibilityColor}; margin-bottom: 10px;">${compatibility}</div>
                                <div style="color: #666;">API Differential: ${apiDiff.toFixed(1)}¬∞</div>
                            </div>
                            
                            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                <strong>Recommendations:</strong>
                                <ul style="margin-top: 10px; margin-left: 20px; color: #666;">
                                    ${apiDiff > 15 ? 
                                        '<li>Consider adding demulsifier</li><li>Ensure adequate mixing</li><li>Monitor for separation</li>' : 
                                        apiDiff > 8 ? 
                                        '<li>Normal processing expected</li><li>Standard mixing sufficient</li>' :
                                        '<li>Excellent compatibility</li><li>No special handling required</li>'}
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <h4 style="color: #34495e; margin: 30px 0 15px 0;">Optimization Results - ${refineryConfig.charAt(0).toUpperCase() + refineryConfig.slice(1)} Refinery</h4>
                    ${optimizationNote ? `<div style="background: #e1f5fe; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #03a9f4;">
                        <strong style="color: #01579b;">Optimization Mode:</strong> ${optimizationTarget === 'maxGasoline' ? 'Maximum Gasoline' : optimizationTarget === 'maxDistillate' ? 'Maximum Distillate' : optimizationTarget === 'maxJet' ? 'Maximum Jet Fuel' : 'Balanced Yields'}
                        <div style="font-size: 0.9em; color: #0277bd; margin-top: 5px;">${optimizationNote}</div>
                    </div>` : ''}
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                        <div style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); padding: 20px; border-radius: 10px; color: white; text-align: center;">
                            <div style="font-size: 1.1em; margin-bottom: 5px;">Revenue</div>
                            <div style="font-size: 2em; font-weight: bold;">$${revenue.toFixed(2)}/bbl</div>
                            <div style="font-size: 0.9em; margin-top: 5px; opacity: 0.9;">$${(revenue * volume).toLocaleString()}/day</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #dc3545 0%, #e91e63 100%); padding: 20px; border-radius: 10px; color: white; text-align: center;">
                            <div style="font-size: 1.1em; margin-bottom: 5px;">Margin (CIF Houston)</div>
                            <div style="font-size: 2em; font-weight: bold;">$${margin.toFixed(2)}/bbl</div>
                            <div style="font-size: 0.9em; margin-top: 5px; opacity: 0.9;">$${(margin * volume).toLocaleString()}/day</div>
                        </div>
                    </div>
                    
                    <h4 style="color: #34495e; margin: 20px 0 15px 0;">Optimized Product Yields</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px;">
                        <div style="background: #e3f2fd; padding: 10px; border-radius: 6px; text-align: center;">
                            <div style="font-size: 0.85em; color: #666;">LPG</div>
                            <div style="font-weight: bold; color: #1976d2;">${(optimizedYields.lpg * 100).toFixed(1)}%</div>
                            ${Math.abs(optimizedYields.lpg - baseBlendYields.lpg) > 0.001 ? `<div style="font-size: 0.75em; color: #666;">(base: ${(baseBlendYields.lpg * 100).toFixed(1)}%)</div>` : ''}
                        </div>
                        <div style="background: #e8f5e9; padding: 10px; border-radius: 6px; text-align: center;">
                            <div style="font-size: 0.85em; color: #666;">Naphtha</div>
                            <div style="font-weight: bold; color: #388e3c;">${(optimizedYields.naphtha * 100).toFixed(1)}%</div>
                            ${Math.abs(optimizedYields.naphtha - baseBlendYields.naphtha) > 0.001 ? `<div style="font-size: 0.75em; color: #666;">(base: ${(baseBlendYields.naphtha * 100).toFixed(1)}%)</div>` : ''}
                        </div>
                        <div style="background: #fff3e0; padding: 10px; border-radius: 6px; text-align: center; ${optimizationTarget === 'maxGasoline' ? 'border: 2px solid #f57c00;' : ''}">
                            <div style="font-size: 0.85em; color: #666;">Gasoline</div>
                            <div style="font-weight: bold; color: #f57c00;">${(optimizedYields.gasoline * 100).toFixed(1)}%</div>
                            ${Math.abs(optimizedYields.gasoline - baseBlendYields.gasoline) > 0.001 ? `<div style="font-size: 0.75em; color: #666;">(base: ${(baseBlendYields.gasoline * 100).toFixed(1)}%)</div>` : ''}
                        </div>
                        <div style="background: #fce4ec; padding: 10px; border-radius: 6px; text-align: center; ${optimizationTarget === 'maxJet' ? 'border: 2px solid #c2185b;' : ''}">
                            <div style="font-size: 0.85em; color: #666;">Jet/Kero</div>
                            <div style="font-weight: bold; color: #c2185b;">${((optimizedYields.kerosene + optimizedYields.jet) * 100).toFixed(1)}%</div>
                            ${Math.abs((optimizedYields.kerosene + optimizedYields.jet) - (baseBlendYields.kerosene + baseBlendYields.jet)) > 0.001 ? `<div style="font-size: 0.75em; color: #666;">(base: ${((baseBlendYields.kerosene + baseBlendYields.jet) * 100).toFixed(1)}%)</div>` : ''}
                        </div>
                        <div style="background: #f3e5f5; padding: 10px; border-radius: 6px; text-align: center; ${optimizationTarget === 'maxDistillate' ? 'border: 2px solid #7b1fa2;' : ''}">
                            <div style="font-size: 0.85em; color: #666;">Diesel</div>
                            <div style="font-weight: bold; color: #7b1fa2;">${(optimizedYields.diesel * 100).toFixed(1)}%</div>
                            ${Math.abs(optimizedYields.diesel - baseBlendYields.diesel) > 0.001 ? `<div style="font-size: 0.75em; color: #666;">(base: ${(baseBlendYields.diesel * 100).toFixed(1)}%)</div>` : ''}
                        </div>
                        <div style="background: #e0e0e0; padding: 10px; border-radius: 6px; text-align: center;">
                            <div style="font-size: 0.85em; color: #666;">VGO</div>
                            <div style="font-weight: bold; color: #616161;">${(optimizedYields.vgo * 100).toFixed(1)}%</div>
                            ${Math.abs(optimizedYields.vgo - baseBlendYields.vgo) > 0.001 ? `<div style="font-size: 0.75em; color: #666;">(base: ${(baseBlendYields.vgo * 100).toFixed(1)}%)</div>` : ''}
                        </div>
                        <div style="background: #efebe9; padding: 10px; border-radius: 6px; text-align: center;">
                            <div style="font-size: 0.85em; color: #666;">Residual</div>
                            <div style="font-weight: bold; color: #5d4037;">${(optimizedYields.residual * 100).toFixed(1)}%</div>
                            ${Math.abs(optimizedYields.residual - baseBlendYields.residual) > 0.001 ? `<div style="font-size: 0.75em; color: #666;">(base: ${(baseBlendYields.residual * 100).toFixed(1)}%)</div>` : ''}
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                        <h4 style="color: #34495e; margin-bottom: 15px;">Cost Breakdown (CIF Houston)</h4>
                        <table style="width: 100%; font-size: 0.9em;">
                            <tr style="border-bottom: 1px solid #dee2e6;">
                                <td style="padding: 8px;">FOB Crude Cost:</td>
                                <td style="text-align: right; padding: 8px;">$${crudeFOBCost.toFixed(2)}/bbl</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #dee2e6;">
                                <td style="padding: 8px;">Average Transport to Houston:</td>
                                <td style="text-align: right; padding: 8px;">$${blendTransportCost.toFixed(2)}/bbl</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #dee2e6;">
                                <td style="padding: 8px;">Operating Cost:</td>
                                <td style="text-align: right; padding: 8px;">$${operatingCost.toFixed(2)}/bbl</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #dee2e6;">
                                <td style="padding: 8px;">Sulfur Penalty:</td>
                                <td style="text-align: right; padding: 8px; color: #dc3545;">$${sulfurPenalty.toFixed(2)}/bbl</td>
                            </tr>
                            <tr style="border-bottom: 2px solid #dee2e6;">
                                <td style="padding: 8px;">API Bonus:</td>
                                <td style="text-align: right; padding: 8px; color: #28a745;">-$${apiBonus.toFixed(2)}/bbl</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px;"><strong>Total Cost (CIF Houston):</strong></td>
                                <td style="text-align: right; padding: 8px;"><strong>$${totalCrudeCost.toFixed(2)}/bbl</strong></td>
                            </tr>
                        </table>
                    </div>
                </div>
            `;
            
            document.getElementById('blendResults').innerHTML = resultsHTML;
            document.getElementById('blendResults').style.display = 'block';
        }
        
        // Custom Crude Functions
        
        function updateTotalYield() {
            const yieldIds = ['yieldLPG', 'yieldNaphtha', 'yieldGasoline', 'yieldKerosene', 
                             'yieldJet', 'yieldDiesel', 'yieldVGO', 'yieldResidual'];
            let total = 0;
            
            yieldIds.forEach(id => {
                const input = document.getElementById(id);
                if (input && input.value) {
                    total += parseFloat(input.value) || 0;
                }
            });
            
            const totalElement = document.getElementById('totalYield');
            if (totalElement) {
                totalElement.textContent = total.toFixed(1) + '%';
                totalElement.style.color = (total >= 98 && total <= 102) ? '#28a745' : '#e74c3c';
            }
        }
        
        function clearCustomForm() {
            document.getElementById('customName').value = '';
            document.getElementById('customOrigin').value = '';
            document.getElementById('customAPI').value = '';
            document.getElementById('customSulfur').value = '';
            
            const yieldIds = ['yieldLPG', 'yieldNaphtha', 'yieldGasoline', 'yieldKerosene', 
                             'yieldJet', 'yieldDiesel', 'yieldVGO', 'yieldResidual'];
            yieldIds.forEach(id => {
                const input = document.getElementById(id);
                if (input) input.value = '';
            });
            
            const totalElement = document.getElementById('totalYield');
            if (totalElement) totalElement.textContent = '0.0%';
        }
        
        function updateCustomCrudeList() {
            const listDiv = document.getElementById('customCrudeTable');
            if (!listDiv || customCrudes.length === 0) {
                if (listDiv) listDiv.innerHTML = '<em style="color: #999;">No custom crudes added yet</em>';
                return;
            }
            
            let html = '<table style="width: 100%;">';
            html += '<tr style="border-bottom: 1px solid #ddd;"><th style="padding: 8px;">Name</th><th>Origin</th><th>API</th><th>Sulfur</th><th>Type</th></tr>';
            
            customCrudes.forEach(crude => {
                html += `<tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 8px;">${crude.name}</td>
                    <td style="padding: 8px;">${crude.origin}</td>
                    <td style="padding: 8px;">${crude.api.toFixed(1)}¬∞</td>
                    <td style="padding: 8px;">${crude.sulfur.toFixed(2)}%</td>
                    <td style="padding: 8px;">${crude.type}</td>
                </tr>`;
            });
            
            html += '</table>';
            listDiv.innerHTML = html;
        }
        
        // Assumptions Functions
        function saveAssumptions() {
            // Show success message
            const statusDiv = document.getElementById('assumptionsStatus');
            if (statusDiv) {
                statusDiv.innerHTML = '<div style="background: #d4edda; color: #155724; padding: 15px; border-radius: 8px;">‚úÖ Settings saved successfully! All calculations will use updated values.</div>';
                setTimeout(() => { statusDiv.innerHTML = ''; }, 3000);
            }
            
            // Refresh dashboard
            updateHotCrudesWithYields(currentConfig);
            updateUpgradeEconomics();
        }
        
        function resetAssumptions() {
            // Reset to defaults
            document.getElementById('baseCrudeCost').value = 75;
            document.getElementById('operatingCost').value = 5;
            document.getElementById('sulfurPenalty').value = 2;
            document.getElementById('apiBonus').value = 0.5;
            document.getElementById('fccGasoline').value = 50;
            document.getElementById('fccLCO').value = 30;
            document.getElementById('fccHCO').value = 15;
            document.getElementById('cokerNaphtha').value = 30;
            document.getElementById('cokerGasOil').value = 40;
            document.getElementById('cokerCoke').value = 20;
            
            // Reset prices
            document.getElementById('priceGasoline').value = 90.30;
            document.getElementById('priceJet').value = 95.50;
            document.getElementById('priceULSD').value = 98.70;
            document.getElementById('priceNaphtha').value = 82.15;
            document.getElementById('priceVGO').value = 68.90;
            document.getElementById('priceFuelOil').value = 55.40;
            
            // Show message
            const statusDiv = document.getElementById('assumptionsStatus');
            if (statusDiv) {
                statusDiv.innerHTML = '<div style="background: #fff3cd; color: #856404; padding: 15px; border-radius: 8px;">‚Ü∫ All settings reset to defaults.</div>';
                setTimeout(() => { statusDiv.innerHTML = ''; }, 3000);
            }
        }
        
        // Initialize on page load
        window.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('Initializing dashboard...');
                updateHotCrudesWithYields('simple');
                updateUpgradeEconomics();
                updateTopPerformer();
                initializeCharts();
                console.log('Dashboard initialized successfully');
            } catch (error) {
                console.error('Error initializing dashboard:', error);
                console.error('Stack trace:', error.stack);
                // Try to show basic content even if charts fail
                try {
                    updateHotCrudesWithYields('simple');
                } catch (e) {
                    console.error('Failed to update hot crudes:', e);
                }
            }
            
            // Add event listeners for yield inputs in custom crude form
            const yieldIds = ['yieldLPG', 'yieldNaphtha', 'yieldGasoline', 'yieldKerosene', 
                             'yieldJet', 'yieldDiesel', 'yieldVGO', 'yieldResidual'];
            yieldIds.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', updateTotalYield);
                }
            });
        });
        
        // Update all dropdowns with new crude
        function updateAllDropdowns() {
            // Update LP Model dropdown
            const lpSelect = document.getElementById('lpCrudeSelect');
            if (lpSelect) {
                lpSelect.innerHTML = '<option value="">Choose a crude...</option>';
                crudeDatabase.forEach(crude => {
                    const option = document.createElement('option');
                    option.value = crude.name;
                    option.textContent = `${crude.name} (${crude.origin}) - API: ${crude.api.toFixed(1)}¬∞, S: ${crude.sulfur.toFixed(2)}%`;
                    lpSelect.appendChild(option);
                });
            }
            
            // Update Blending Calculator dropdowns
            ['blendCrude1', 'blendCrude2'].forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    const currentValue = select.value;
                    select.innerHTML = '<option value="">Choose crude...</option>';
                    crudeDatabase.forEach(crude => {
                        const option = document.createElement('option');
                        option.value = crude.name;
                        option.textContent = `${crude.name} (${crude.origin})`;
                        select.appendChild(option);
                    });
                    select.value = currentValue; // Restore selection
                }
            });
        }
    </script>
</body>
</html>